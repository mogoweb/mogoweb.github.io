<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[放飞梦想]]></title>
  <link href="http://mogoweb.net/atom.xml" rel="self"/>
  <link href="http://mogoweb.net/"/>
  <updated>2015-11-25T11:41:39+08:00</updated>
  <id>http://mogoweb.net/</id>
  <author>
    <name><![CDATA[mogoweb]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Android源码阅读与理解（二）：Android系统Build流程详解]]></title>
    <link href="http://mogoweb.net/blog/2015/11/17/android-system-building-flow/"/>
    <updated>2015-11-17T08:51:50+08:00</updated>
    <id>http://mogoweb.net/blog/2015/11/17/android-system-building-flow</id>
    <content type="html"><![CDATA[<p>个人认为，成为一个靠谱的Android系统工程师，必须具备以下技能：</p>

<ul>
<li>翻墙</li>
<li>会使用Linux系统</li>
<li>阅读英文资料</li>
</ul>


<p>翻墙技能就不用说了，因为不翻墙，Android源码难以获取，更不用谈体验墙外精彩的世界了。关于第二点，最好的Android系统开发环境就是Linux（推荐ubuntu），如果能够熟练使用Linux系统可以节省不少折腾环境的时间。最后英文阅读能力也很关键，因为碰到问题Google, <a href="http://www.stackoverflow.com">StackOverflow</a>非常有用，上面的回答有不少是用英文写的。</p>

<p>在这里略过下载Android源码，最好的方法是参考<a href="http://source.android.com">官方文档</a>。简单说一下我的环境：</p>

<ul>
<li>Ubuntu 14.04 LTS 64位</li>
<li>Android 5.1.1源码</li>
<li>Sublime Text 2</li>
<li>Intel&reg; Core&trade; i7-2630QM CPU @ 2.00GHz, 8G RAM, 1TB hd</li>
</ul>


<p>配备一台Nexus 4/5也是极好的，这个上淘宝，几百元就能搞定，可以省下不少时间（用模拟器也可以，但是比较慢，对主机要求也比较高）。Nexus系列作为google的亲儿子，通常都会得到最新的更新，最适合折腾系统了。</p>

<p>源码下载后，执行如下命令即可编译Android系统(后面的文章将使用$ANDROID_SRC指代Android源码所在目录，如非特别指明，假设命令行在Android源码目录下执行):</p>

<ol>
<li>source build/envsetup.sh</li>
<li>lunch</li>
<li>make -j4</li>
</ol>


<p>下面就解析以上三个步骤分别做了什么事情。</p>

<h2>设置环境变量</h2>

<p>打开$ANDROID_SRC/build/envsetup.sh文件，我们可以看到文件中定义了一些shell函数，其作用是初始化编译环境，并引入一些辅助的Shell函数，这其中就包括第二步使用lunch函数。这些shell函数可以看做shell命令，方便我们进行一些build任务，比如常用的mm。下面就列出一些常用的函数：</p>

<p><strong>表 1. build/envsetup.sh 中定义的常用函数</strong></p>

<hr />

<table>
<thead>
<tr>
<th style="text-align:left;"> <strong>名称</strong> </th>
<th style="text-align:left;"> <strong>说明</strong> </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">lunch          </td>
<td style="text-align:left;"> 选择产品，格式为lunch BUILDID-BUILDTYPE，如果不指定，会弹出一个列表选择 </td>
</tr>
<tr>
<td style="text-align:left;">tapas          </td>
<td style="text-align:left;"> build未打包到image的app，命令行后可以跟一个或者多个app的名称。用法为: tapas [<App1> <App2> &hellip;] [arm|x86|mips|armv5|arm64|x86_64|mips64] [eng|userdebug|user] </td>
</tr>
<tr>
<td style="text-align:left;">croot          </td>
<td style="text-align:left;"> 切换到源码树的根目录 </td>
</tr>
<tr>
<td style="text-align:left;">m              </td>
<td style="text-align:left;"> 在源码树的根目录执行 make </td>
</tr>
<tr>
<td style="text-align:left;">mm             </td>
<td style="text-align:left;"> Build 当前目录下的模块 </td>
</tr>
<tr>
<td style="text-align:left;">mmm                </td>
<td style="text-align:left;"> Build 指定目录下的模块 </td>
</tr>
<tr>
<td style="text-align:left;">mma            </td>
<td style="text-align:left;"> Build 当前目录下的模块及所有依赖的模块 </td>
</tr>
<tr>
<td style="text-align:left;">mmma           </td>
<td style="text-align:left;"> Build 指定目录下的模块及所有依赖的模块 </td>
</tr>
<tr>
<td style="text-align:left;">cgrep          </td>
<td style="text-align:left;"> 在所有 C/C++ 文件上执行 grep </td>
</tr>
<tr>
<td style="text-align:left;">ggrep          </td>
<td style="text-align:left;"> 在所有 Gradle 文件上执行 grep </td>
</tr>
<tr>
<td style="text-align:left;">jgrep          </td>
<td style="text-align:left;"> 在所有 Java 文件上执行 grep </td>
</tr>
<tr>
<td style="text-align:left;">resgrep        </td>
<td style="text-align:left;"> 在所有 res/*.xml 文件上执行 grep </td>
</tr>
<tr>
<td style="text-align:left;">sgrep          </td>
<td style="text-align:left;"> 在所有源码上执行grep </td>
</tr>
<tr>
<td style="text-align:left;">godir          </td>
<td style="text-align:left;"> 转到包含某个文件的目录路径 </td>
</tr>
<tr>
<td style="text-align:left;">printconfig    </td>
<td style="text-align:left;"> 显示当前 Build 的配置信息 </td>
</tr>
<tr>
<td style="text-align:left;">add_lunch_combo</td>
<td style="text-align:left;"> 在 lunch 函数的菜单中添加一个条目 </td>
</tr>
</tbody>
</table>


<p>除了定义辅助Shell函数，在脚本的结尾处，还会遍历device和vendor目录下的vendorsetup.sh文件，vendorsetup.sh文件定义与设备相关的环境变量，比如<em>/device/lge/hammerhead/vendorsetup.sh</em>就定义了如下：</p>

<blockquote><p>add_lunch_combo aosp_hammerhead-userdebug</p></blockquote>

<p>这会在lunch菜单中增加一个选项：aosp_hammerhead-userdebug</p>

<h2>lunch函数详解</h2>

<p>Android支持不同的硬件，比如不同的CPU架构（ARM、MIPS，X86），不同厂商的外设（如蓝牙、wifi、基带等），另外可能还需要分Debug版本和Release版本，这都是在lunch中进行选择的。lunch命令的格式为lunch BUILDID-BUILDTYPE，其中BUILDTYPE取值如下：</p>

<p><strong>表 2. BUILDTYPE说明</strong></p>

<hr />

<table>
<thead>
<tr>
<th style="text-align:left;"> <strong>BUILDTYPE</strong> </th>
<th style="text-align:left;"> <strong>说明</strong> </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">user           </td>
<td style="text-align:left;"> 相当于Release版本，无root权限，不打包调试工具，适合最后的产品发布 </td>
</tr>
<tr>
<td style="text-align:left;">userdebug      </td>
<td style="text-align:left;"> 和user类似，但多了root权限，可以调试，适合于产品调试 </td>
</tr>
<tr>
<td style="text-align:left;">eng            </td>
<td style="text-align:left;"> 开发阶段的配置，另外还打包了许多调试工具，适合于产品初期阶段 </td>
</tr>
</tbody>
</table>


<p>BUILDID则是一组特性集合的代码，这个通常与具体的平台相关。除了Android源码预置的选项外，还可以通过add_lunch_combo命令添加自定义的组合。当我们要开发一款新的Android产品时，首先就需要在Build系统中添加对于该产品的定义。</p>

<p>产品定义文件通常位于device目录下，vendor目录已经不建议使用（nexus系列的产品定义就是放在vendor目录）。device目录下通常根据公司名及产品名分为二级目录，比如lge的目录结构如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> device
</span><span class='line'>   |-- lge
</span><span class='line'>         |-- hammerhead
</span><span class='line'>         |-- hammerhead-kernel
</span><span class='line'>         |-- mako
</span><span class='line'>         |-- mako-kernel</span></code></pre></td></tr></table></div></figure>


<p>其中mako和hammerhead分别为nexus4和nexus5的产品代号。通常一个产品定义至少包含4个文件：AndroidProducts.mk, BoardConfig.mk, vendorsetup.sh及版本定义文件（文件名不固定）。关于如何添加产品定义，请参考<a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-android-build/index.html">&lt;&lt;理解 Android Build 系统>></a>一文的<strong>添加新的产品</strong>一节。</p>

<h2>build Android系统</h2>

<p>最后一步执行<em>make -j4</em>才开始真正的进行编译操作，j后面的数字代表同时编译的job数，这个数字可根据CPU核心线程数而定，通常可指定为CPU核心线程的1~2倍，数字越大，代表同时进行编译的任务越多，整个编译过程也会越快，但需要注意过犹不及。如果不指定目标，默认就会使用“droid”目标，build出完整的Android系统镜像。</p>

<p>Android build系统使用了GNU make，这点很让人意外，因为GNU Makefile实在太难编写了，也不易阅读。不过Google的天才工程师进行了模块化、写了很多实用函数，修改/添加起来还算容易。</p>

<h3>Build输出目录结构</h3>

<p>所有的编译产物都将位于 out 目录下，该目录下主要有以下几个子目录：</p>

<ul>
<li>out/host/：该目录下包含了host端的工具和库，例如：emulator，adb，aapt等。</li>
<li>out/target/common/：该目录下包含了针对设备的共用的编译产物，主要是 Java 应用代码和 Java 库。</li>
<li>out/target/product/<em>product_name</em>/：包含了针对特定设备的编译结果以及平台相关的 C/C++ 库和二进制文件。其中，<em>product_name</em>是具体目标设备的名称。</li>
</ul>


<h3>Build生成的镜像文件</h3>

<p>Build 的产物中最重要的是三个镜像文件，它们都位于 out/target/product/<em>product_name</em>/ 目录下。这三个文件是：</p>

<ul>
<li>system.img：包含了 Android OS 的系统文件，库，可执行文件以及预置的应用程序，将被挂载为根分区。</li>
<li>ramdisk.img：在启动时将被 Linux 内核挂载为只读分区，它包含了 /init 文件和一些配置文件。它用来挂载其他系统镜像并启动 init 进程。</li>
<li>userdata.img：将被挂载为 /data，包含了应用程序相关的数据以及和用户相关的数据。</li>
</ul>


<p>另外还有cache.img,启动模拟器时可使用-cache参数来挂载该文件，指定/cache内容。一般来说我们不直接使用userdata.img，而是使用userdata_qemu.data，用来存放用户数据，可读写，android启动后mount到 /data。只有使用-wipe-data参数启动模拟器是时候才会用到userdata.img，它会使用userdata.img的内容覆盖userdata-qemu.img。</p>

<h2>参考文档</h2>

<ol>
<li><a href="http://www.stackoverflow.com">Android官方文档</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-android-build/index.html">理解 Android Build 系统</a></li>
<li><a href="http://www.cloudchou.com/android/post-134.html">Android编译系统详解(一)——build/envsetup.sh</a></li>
<li><a href="http://www.devdiv.com/android_-blog-1-1488.html">Android模拟器镜像文件介绍</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android源码阅读与理解（一）：开篇]]></title>
    <link href="http://mogoweb.net/blog/2015/11/13/reading-android-source-preface/"/>
    <updated>2015-11-13T20:36:35+08:00</updated>
    <id>http://mogoweb.net/blog/2015/11/13/reading-android-source-preface</id>
    <content type="html"><![CDATA[<p>作为一个自认为苦逼的程序员，有一阵子曾考虑逃离程序世界，做一个文艺青年。你看，出去旅旅游、读读书、摄个影，没事发个呆，生活该是多么的惬意。反观程序员，每天对着冰冷的机器，有事无事还要加个班。正如一个段子所写：</p>

<blockquote><p>你苦战通宵游戏时，布里斯班的灯鱼已划过珊瑚丛;</p>

<p>你赶场招聘会时，蒙巴萨的小蟹刚溜出渔夫的掌心;</p>

<p>你写程序代码时，布拉格的电车正摇着铃晃过金色夕阳;</p>

<p>你挤进汹涌的食堂时，哥本哈根的街头画家完成了第99幅立体画。</p>

<p>有一些穿高跟鞋走不到的路，有一些喷着香水闻不到的空气，有一些在楼宇里永远碰遇不到的人。</p></blockquote>

<p>但是，看村上春书的《当我谈跑步时我谈些什么》如同嚼蜡，看侯孝贤、王家卫的电影直睡觉之后，我发现其实身上缺少文艺细胞，无事发呆更是让我难受。其实仔细想想，写代码时虽然苦逼，但是当纠出一个苦苦追寻了半个月的bug的时刻，内心还是感觉很爽的。不读村上春树，读读东野圭吾也挺开心的。每天充实的感觉比无所事事更舒服。所以，我还是需要做回自己，做自己喜欢、自己擅长的事情。读到池建强的《是旅行还是长跑》中这样一段话：</p>

<blockquote><p>只要你没有一个强悍的爹，就要先忘掉那些小鱼小蟹，还有珊瑚丛，那些暂时还不属于你，踏踏实实地练习和提升才是王道，为自己规划一个十年的长跑，可以时不时停下来休息一下，低下头汗水就落入尘埃，抬起头就看看夕阳西下，你抹去疲惫，然后继续前行。十年看似很长，但实在很短，十年以后你回头看看，你究竟是成了人中龙凤，还是小鱼小虾，是你认知了世界，还是世界抛弃了你。</p></blockquote>

<p>瞬间引起了共鸣。</p>

<p>闲话扯远了，作为一个国产OS的从业者，一直都从Android系统吸(chao)收(xi)营(yuan)养(ma)。其实我们更想借鉴ios系统，可惜人家不开源，光看表面是做不了神似的。在开发的过程中，也碰到不少问题，零零碎碎读过一些Android的源码，但基本上都是现学现用，缺乏整体的理解。既然做不了文艺青年，那我就来挑战一下Android系统源码吧。当然现在Android源码分析的书和文章也比较多，比如我手头就有邓凡平的《深入理解Android》、杨云君的《Android的设计与实现》和罗升阳的《Android系统源代码情景分析》，网上的文章更是不计其数。但别人分析了也是别人的，买了他们的书，但买不到他们的知识。还是需要亲自深入代码分析，知识才能变成我的。</p>

<p>在后续的学习中，我将结合自身的工作，分析我所感兴趣的部分。Android系统是一个相当庞大的系统，想要深入掌握每个细节，那是一个不可能完成的任务。所以我会略去驱动、linux内核、media等部分，初步计划阅读的部分如下：</p>

<ol>
<li>Android build系统</li>
<li>Android系统启动</li>
<li>Binder原理与实现</li>
<li>Surface系统</li>
<li>Dalvik虚拟机</li>
<li>chromium Webview</li>
</ol>


<p>为了让自己能坚持下去，要求在阅读过程中记笔记，每周至少写一篇博客，梳理一下阅读心得。希望我能够坚持下去并有所得，加油！</p>

<p><strong>[注]</strong> 本文引用的文字出自池建强《MacTalk人生元编程》P.194。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[基于chromium for android开发Android浏览器]]></title>
    <link href="http://mogoweb.net/blog/2015/11/03/develop-android-browser-base-on-chromium-for-android/"/>
    <updated>2015-11-03T08:39:21+08:00</updated>
    <id>http://mogoweb.net/blog/2015/11/03/develop-android-browser-base-on-chromium-for-android</id>
    <content type="html"><![CDATA[<p>在上一篇文章&lt;&lt; <a href="http://mogoweb.net/blog/2015/09/25/chromium-for-android-already-open-source/">Chromium for Android开源了</a> >>中谈到了Google已经完全开源了Chromium for Android，这样我们就完全可以开发与Chrome for Android媲美的Android浏览器了。通常浏览器的一些新特性和新功能会先出现在Chromium for Android上，稳定后才会出现在Chrome for Android上，如果我们基于Chromium for Android开发浏览器产品，在新特性和新功能方面不会落后于Chrome浏览器.</p>

<p>Chromium开源项目的代码及其庞大，也相当的复杂。对于Android开发人员，特别是UI开发人员来说，没有一个合适的IDE环境，会是一个非常痛苦的事情。我们通常是这样开发的，在sublime text中阅读、修改代码，使用chromium的构建系统build出apk，安装到手机，进行调试。对于native代码来说，这样的开发方式也不会有太多麻烦，因为native部分的代码通常修改很少。但如果主要进行UI的定制，这种开发方式就非常痛苦了。</p>

<p>为了应对这个问题，考虑如下方案：</p>

<ol>
<li>采用Android Studio作为开发环境，从Chromium for Android抽取chrome模块的源码，加入Android project。</li>
<li>native代码在chromium环境中build，作为so加入Android project</li>
<li>基础模块(base, content, net等)在chromium环境build为jar包，加入Android project</li>
<li>content, chrome, ui等模块的资源文件加入Android library project</li>
</ol>


<p>资源文件为什么不能直接都添加到Android project呢？因为命名空间的原因，比如content模块的资源的命名空间为org.chromium.content, chrome模块的资源的命名空间为org.chromium.chrome，所以需要建立不同的Android library project, 指定不同的包名。最后整个项目的结构如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>browser
</span><span class='line'>  |_ app
</span><span class='line'>  |    |_ libs
</span><span class='line'>  |    |_ src
</span><span class='line'>  |         |_ main
</span><span class='line'>  |              |_ aidl
</span><span class='line'>  |              |_ assets
</span><span class='line'>  |              |_ java
</span><span class='line'>  |              |_ jniLibs
</span><span class='line'>  |              |_ res
</span><span class='line'>  |_ libraries
</span><span class='line'>       |_ androidmedia_res
</span><span class='line'>       |_ chrome_res
</span><span class='line'>       |_ content_res
</span><span class='line'>       |_ datausagechart_res
</span><span class='line'>       |_ ui_res</span></code></pre></td></tr></table></div></figure>


<p>注意事项：</p>

<ol>
<li>chromium项目的源码和资源有些是自动生成的，需要到out目录下去复制</li>
<li>pak和dat等文件需要加入到assets目录，而且不能压缩</li>
<li>aidl文件加入到main/aidl下，android studio会自动处理</li>
</ol>


<p>实践证明，这种方案是行之有效的，请参考github上的项目: <a href="https://github.com/mogoweb/365browser">365browser</a>。在script目录下有从chromium项目同步代码和资源的脚本。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Chromium for Android开源了]]></title>
    <link href="http://mogoweb.net/blog/2015/09/25/chromium-for-android-already-open-source/"/>
    <updated>2015-09-25T09:08:49+08:00</updated>
    <id>http://mogoweb.net/blog/2015/09/25/chromium-for-android-already-open-source</id>
    <content type="html"><![CDATA[<p>最近一段时间都在忙其它的事情，没有关注chromium的最新进展。这几天浏览 <a href="http://www.chromium.org">http://www.chromium.org</a> 上的文档，发现android build目标增加了一个：chrome_public_apk。编译方法：</p>

<blockquote><h1>Build the full browser</h1>

<p>~/chromium/src$ ninja -C out/Release chrome_public_apk</p>

<p>~/chromium/src$ build/android/adb_install_apk.py out/Release/apks/ChromePublic.apk</p></blockquote>

<p>搜索了一下相关新闻，大约在2015年5月份开始，chromium中开始加入了chrome for android的源码。从2012年开始，chromium中开始出现Android的移植代码，但只有Content API和ContentShell，离一个完备的浏览器还有一定的距离。当然，基于Content API开发浏览器也是可行的，当年就是这么干的。Chromium for Android和Chrome for Android并非完全一样，就如同桌面版Chromium浏览器和Chrome浏览器之间的区别。</p>

<p>下面放上一些Chromium for Android浏览器的截图，慢慢品味吧：</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_welcome.png" alt="welcome" /></p>

<p>欢迎界面</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_account.png" alt="account" /></p>

<p>帐号同步界面</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_main.png" alt="main" /></p>

<p>浏览器主界面</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_menu.png" alt="menu" /></p>

<p>浏览器菜单</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_settings.png" alt="settings" /></p>

<p>浏览器设置</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_tabs.png" alt="tabs" /></p>

<p>浏览器标签页</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[打造自己的chrome for android]]></title>
    <link href="http://mogoweb.net/blog/2015/09/10/customize-chrome-for-android/"/>
    <updated>2015-09-10T22:01:54+08:00</updated>
    <id>http://mogoweb.net/blog/2015/09/10/customize-chrome-for-android</id>
    <content type="html"><![CDATA[<p>[注] 这是两年前写的一篇旧文，现翻出来，根据现在的实际变化作了修订。</p>

<p>chromium移植已经接近尾声，正在冲刺beta版本。不过越往后面，越是一些难啃的骨头。虽然背靠chromium这座大山，但是网页的复杂性超乎想象。更郁闷的是，有些BUG在chrome for android上没有，但在我们的浏览器上存在。因此经常会有这样的质疑：人家的chrome浏览器好好的，你做的浏览器为什么会有这样的问题。面对这样的质疑，真是有苦说不出。在有些人看来，别人都把源代码开放出来了，超过他们是理所当然的。没有办法，碰到难啃的骨头只能迎难而上了。好在chrome for android（V25之后的版本）开始支持自行定制了，虽然没法调试全部的代码，但是部分代码还是可以调试的。这样在分析我们和chrome浏览器在代码执行路径上的差异，也许能够提供一种思路。下面就谈谈如何构建自己的chrome for android。</p>

<!--excerpt-->


<ol>
<li><p>使用您的android设备下载chrome for android，如果能够翻墙的话就在Google Play下载，国内的应用商店也一般有，这里就不详细说了。</p></li>
<li><p>打开您的android设备上的chrome for android，地址栏中输入chrome://version</p></li>
<li><p>记下Build ID(版本号ID)后的那一长串数字。</p></li>
<li><p>在PC机上访问 <a href="http://storage.googleapis.com/chrome-browser-components/">http://storage.googleapis.com/chrome-browser-components/</a>&lt;BUILD_ID>/index.html。其中&lt;BUILD_ID>为步骤3中的ID。下载该页面所列的文件。以下将以$CHROME_PREBUILT指代所存放的目录。</p></li>
<li><p>下载与chrome for android版本对应的chromium源码，请参考[<a href="http://dev.chromium.org/developers/how-tos/get-the-code#TOC-Check-out-the-source-for-a-branch-or-specific-release">http://dev.chromium.org/developers/how-tos/get-the-code#TOC-Check-out-the-source-for-a-branch-or-specific-release</a>]上的指导将代码切换到正确的release分支。下面就以$CHROMIUM_SRC指代chromium源码的src目录</p></li>
<li><p>build出自己的libchromeview.so库</p>

<ul>
<li>cd $CHROMIUM_SRC</li>
<li>mkdir chrome-android-prebuilts</li>
<li>cp $CHROME_PREBUILT/chromeview_target.gyp chrome-android-prebuilts/libchrome.gyp</li>
<li>mkdir -p out/Release</li>
<li>cp $CHROME_PREBUILT/libchrome_android_prebuilt.a out/Release</li>
<li>CHROMIUM_GYP_FILE=&ldquo;chrome-android-prebuilts/libchrome.gyp&rdquo; build/gyp_chromium</li>
<li>ninja -C  out/Release libchrome_prebuilt</li>
</ul>
</li>
<li><p>解包官方chrome的apk</p>

<ul>
<li> 使用USB连接设备</li>
<li> cd $CHROME_SRC</li>
<li> mkdir out/apk</li>
<li> cd out/apk</li>
<li> adb pull $(adb shell pm path $CHROME_PACKAGE | sed &#8216;s/package:([^\r ]+).*$/\1/g&#8217;)</li>
<li> 将pull出的apk重命名为Chrome.apk</li>
<li> apktool d Chrome.apk</li>
</ul>


<p> 注1：您也可以从网上下载Chrome for android，但要确保下载正确的版本</p>

<p> 注2：apktool 可以从<a href="http://code.google.com/p/android-apktool/">http://code.google.com/p/android-apktool/</a> 下载</p></li>
<li><p>更新应用程序包</p>

<ul>
<li> cp $CHROME_PREBUILT/change_chromium_package.py .</li>
<li> chmod a+x change_chromium_package.py</li>
<li> ./change_chromium_package.py -u Chrome -p desired_package_name -a desired_app_name</li>
<li> cp $CHROMIUM_SRC/out/Release/lib.target/libchromeview_prebuilt.so libchromeview.so</li>
<li> arm-linux-androideabi-strip libchromeview.so</li>
<li> cp libchromeview.so $CHROMIUM_SRC/out/apk/Chrome/lib/armeabi-v7a</li>
</ul>
</li>
<li><p>重新打包和安装apk</p>

<ul>
<li> apktool b Chrome Chromium_unaligned.apk</li>
<li> 签名apk，为了简便起见，可以使用debug key：</li>
</ul>


<blockquote><p>jarsigner -sigalg MD5withRSA -digestalg SHA1 -keystore PATH_TO_ANDROID_SDK/.android/debug.keystore -storepass android Chromium_unaligned.apk androiddebugkey</p></blockquote>

<ul>
<li> zipalign -f -v 4 Chromium_unaligned.apk Chromium.apk</li>
<li> adb install -r Chromium.apk</li>
</ul>
</li>
</ol>


<p>到此，自有品牌的chrome浏览器就此诞生，您可以更换logo，修复chromium的bug等等。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何打印gyp构建系统中的变量值]]></title>
    <link href="http://mogoweb.net/blog/2015/06/30/how-to-print-variable-of-gyp/"/>
    <updated>2015-06-30T14:16:51+08:00</updated>
    <id>http://mogoweb.net/blog/2015/06/30/how-to-print-variable-of-gyp</id>
    <content type="html"><![CDATA[<p>chromium项目使用了gyp构建系统，gyp的全称是&#8221;Generate Your Projects&#8221;。gyp构建系统使用的并不广泛，目前已知的只有chromium开源项目采用了这一构建系统。官方虽然也有一些文档，但都是一些比较基础的指南，总体来说缺少详细的文档来指导开发人员在项目中使用。
因为研究chromium的缘故，所以对gyp构建系统也有一些了解，在使用中也碰到一些问题，本文所要探讨的是如何输出gyp的变量值。这个问题的场景是这样的：在gyp中定义了变量，但是经过多重gypi包含，在别的gyp文件中可能对变量值进行了赋值。处于调试目的，我们希望输出gyp变量的值。</p>

<p>方法看起来很简单，但也摸索了很久。方法如下，在gyp中合适的位置加入如下代码：</p>

<pre><code>'variables': {
  'mytest': '&lt;!(echo &lt;(variable) 1&gt;&amp;2)',
}
</code></pre>

<p>其中&#8217;mytest&#8217;是我随便定义的一个变量值，variable是希望打印的gyp变量。比如以下语句：</p>

<pre><code>'variables': {
  'mytest': '&lt;!(echo &lt;(OS) 1&gt;&amp;2)',
}
</code></pre>

<p>输出如下结果：</p>

<pre><code>Updating projects from gyp files...
android
gyp: Call to 'echo android 1&gt;&amp;2' returned exit status 0.
</code></pre>

<p>从上面的输出可以看出，OS的变量值为android。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在Chromium for Android中能否用TextureView替代SurfaceView]]></title>
    <link href="http://mogoweb.net/blog/2015/06/19/using-textureview-instead-of-surfaceview-in-chrome-for-android/"/>
    <updated>2015-06-19T19:26:45+08:00</updated>
    <id>http://mogoweb.net/blog/2015/06/19/using-textureview-instead-of-surfaceview-in-chrome-for-android</id>
    <content type="html"><![CDATA[<p>在开发Browser 2.0时，碰到一个非常头疼的问题，往布局上添加SurfaceView时，会引起黑屏闪一下。为了解决这个问题，我们不得不在初始化阶段就把SurfaceView添加好，之后也不能调整大小、移动位置。当时就考虑是不是能够用TextureView替代SurfaceView，不过由于计划上的调整，没有做进一步的尝试。今天在网上看到<a href="https://github.com/crosswalk-project/crosswalk-website/wiki/Android-SurfaceView-vs-TextureView">这篇文章</a>，正好解答了我的疑问，在此把文章翻译过来，供参考。</p>

<blockquote><h1>Android SurfaceView和textureView</h1>

<p>本文将简要介绍SurfaceView和TextureView的不同之处</p>

<h2>SurfaceView和TextureView</h2>

<p>SurfaceView和TextureView都继承自android.view.View类，他们都可以在另一个独立线程中绘制和渲染，这是和其它View的最大不同。Crosswalk采用这一分离绘制特性，独立的GPU线程显著提高了渲染效率。</p>

<p>SurfaceView提供一个嵌入在视图层次上的专用绘制表面，您可以控制该表面（Surface）的格式和尺寸。SurfaceView负责将表面放置在屏幕上正确的位置。它的行为多少有些类似于传统桌面系统上的onscreen窗口，比如，X11系统中的XWindow可以是无边框的，嵌入在另一个XWindow中。</p>

<p>SurfaceView存在如下两个缺点：</p>

<ul>
<li>不能应用动画、变换和缩放</li>
<li>不能叠加（Overlay）两个SurfaceView</li>
</ul>


<p>TextureView看似更像一个通用的View，可以应用动画、变换和缩放，就如同TextView。TextureView只能用在硬件加速的窗口。但是，TextureView比SurfaceView更耗内存，而且可能会有1～3帧的延迟，请参考讨论<a href="https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4">3</a>。</p>

<h2>使用可以动画的XWalkView</h2>

<p>Crosswalk Embedding API for Android很好的支持了SurfaceView和TextureView。XWalkView缺省使用SurfaceView，也允许您在以下情况下使用TextureView：</p>

<ul>
<li>您想让XWalkView支持动画和变换</li>
<li>您想叠加两个XWalkView</li>
</ul>


<p>设置布尔标识ANIMATIBLE_XWALK_VIEW为true即可启用TextureView。</p>

<ol>
<li><a href="http://developer.android.com/reference/android/view/SurfaceView.html">http://developer.android.com/reference/android/view/SurfaceView.html</a></li>
<li><a href="http://developer.android.com/reference/android/view/TextureView.html">http://developer.android.com/reference/android/view/TextureView.html</a></li>
<li><a href="https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4">https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4</a></li>
</ol>
</blockquote>

<p>文中提到的讨论起源是在google groups中有人提出如下问题：</p>

<blockquote><p>在当前ContentViewRenderView实现中，使用SurfaceView作为合成表面(compositing surface)，如我们所知，SurfaceView是一个特别的视图，无法进行动画或者变换。</p>

<p>TextureView可以做SufaceView同样的事情，比如，您可以在另一个独立线程中渲染，也可以从底下的SurfaceTexture创建一个egl表面(eglSurface)。更主要的是，TextureView可以进行动画和变换。</p>

<p>我很好奇为什么不使用TextureView作为合成表面，是否TextureView在使用上有一些特别的考虑，比如性能问题？欢迎任何讨论。</p></blockquote>

<p>Google groups有人做如下回复：</p>

<blockquote><p>事实上chrome过去使用TextureView作为合成表面，但我们出于几个原因切换到SurfaceView：</p>

<ul>
<li>由于失效(invalidation)和缓冲的特性，TextureView增加了额外1~3帧的延迟显示画面更新</li>
<li>TextureView总是使用GL合成，而SurfaceTexture可以使用硬件overlay后端，可以占用更少的内存带宽，消耗更少的能量</li>
<li>TextureView的内部缓冲队列导致比SurfaceView使用更多的内存</li>
<li>TextureView的动画和变换能力我们用不上</li>
</ul>
</blockquote>

<p>所以结论是Chromium for Android中可以使用TextureView替代SurfaceView作为合成表面，但带来的后果是占用更多的内存，性能下降。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于Ubuntu菜单项中的%U参数]]></title>
    <link href="http://mogoweb.net/blog/2015/03/11/about-percent-u-paramters-in-ubuntu-menu-entry/"/>
    <updated>2015-03-11T16:05:57+08:00</updated>
    <id>http://mogoweb.net/blog/2015/03/11/about-percent-u-paramters-in-ubuntu-menu-entry</id>
    <content type="html"><![CDATA[<p>今天在研究chromium deb打包的时候，发现Google Chrome deb包中的/usr/share/applications/google-chrome.desktop文件定义入口为：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Exec=/usr/bin/google-chrome-stable %U</span></code></pre></td></tr></table></div></figure>


<p>这个%U参数是做什么用的呢？查找了一下资料，有如下描述：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%u A single URL. Local files may either be passed as file: URLs or as file path.
</span><span class='line'>
</span><span class='line'>%U A list of URLs. Each URL is passed as a separate argument to the executable program. Local files may either be passed as file: URLs or as file path.</span></code></pre></td></tr></table></div></figure>


<p>也就是说，加入了%U参数，可以传递多个URL给Chrome浏览器，浏览器会依次打开各URL。比如您在文件管理器中选择了多个html文件，然后在鼠标右键菜单中点击&#8221;Open with Google Chrome&#8221;，Chrome浏览器就会依次打开所选的网页。</p>

<p>以下是Exec支持的参数说明，来自<a href="http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s06.html">http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s06.html</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Code Description
</span><span class='line'>%f    A single file name, even if multiple files are selected. The system reading the desktop entry should recognize that the program in question cannot handle multiple file arguments, and it should should probably spawn and execute multiple copies of a program for each selected file if the program is not able to handle additional file arguments. If files are not on the local file system (i.e. are on HTTP or FTP locations), the files will be copied to the local file system and %f will be expanded to point at the temporary file. Used for programs that do not understand the URL syntax.
</span><span class='line'>%F    A list of files. Use for apps that can open several local files at once. Each file is passed as a separate argument to the executable program.
</span><span class='line'>%u    A single URL. Local files may either be passed as file: URLs or as file path.
</span><span class='line'>%U    A list of URLs. Each URL is passed as a separate argument to the executable program. Local files may either be passed as file: URLs or as file path.
</span><span class='line'>%d    Deprecated.
</span><span class='line'>%D    Deprecated.
</span><span class='line'>%n    Deprecated.
</span><span class='line'>%N    Deprecated.
</span><span class='line'>%i    The Icon key of the desktop entry expanded as two arguments, first --icon and then the value of the Icon key. Should not expand to any arguments if the Icon key is empty or missing.
</span><span class='line'>%c    The translated name of the application as listed in the appropriate Name key in the desktop entry.
</span><span class='line'>%k    The location of the desktop file as either a URI (if for example gotten from the vfolder system) or a local filename or empty if no location is known.
</span><span class='line'>%v    Deprecated.
</span><span class='line'>%m    Deprecated.</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu 14.04 VirtualBox启动问题之解决]]></title>
    <link href="http://mogoweb.net/blog/2015/03/11/solve-the-virtualbox-starting-problem/"/>
    <updated>2015-03-11T08:54:49+08:00</updated>
    <id>http://mogoweb.net/blog/2015/03/11/solve-the-virtualbox-starting-problem</id>
    <content type="html"><![CDATA[<p>开发机上的Ubuntu从12.10升级到14.04后，发现VirtualBox无法启动，有如下提示</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Setting up virtualbox (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'> * Stopping VirtualBox kernel modules                   [ OK ] 
</span><span class='line'> * Starting VirtualBox kernel modules
</span><span class='line'>     * No suitable module for running kernel found
</span><span class='line'>                                                        [fail]
</span><span class='line'>invoke-rc.d: initscript virtualbox, action "restart" failed.</span></code></pre></td></tr></table></div></figure>


<p>解决方法如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get purge virtualbox
</span><span class='line'>sudo apt-get install linux-generic linux-image-generic linux-headers-generic linux-signed-generic
</span><span class='line'>sudo apt-get install virtualbox</span></code></pre></td></tr></table></div></figure>


<p>安装irtualbox的信息如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree       
</span><span class='line'>Reading state information... Done
</span><span class='line'>The following extra packages will be installed:
</span><span class='line'>  virtualbox-dkms virtualbox-qt
</span><span class='line'>Suggested packages:
</span><span class='line'>  virtualbox-guest-additions-iso vde2
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  virtualbox virtualbox-dkms virtualbox-qt
</span><span class='line'>0 upgraded, 3 newly installed, 0 to remove and 29 not upgraded.
</span><span class='line'>Need to get 0 B/20.5 MB of archives.
</span><span class='line'>After this operation, 84.1 MB of additional disk space will be used.
</span><span class='line'>Do you want to continue? [Y/n] y
</span><span class='line'>WARNING: The following packages cannot be authenticated!
</span><span class='line'>  virtualbox virtualbox-dkms virtualbox-qt
</span><span class='line'>Install these packages without verification? [y/N] y
</span><span class='line'>Selecting previously unselected package virtualbox.
</span><span class='line'>(Reading database ... 276049 files and directories currently installed.)
</span><span class='line'>Preparing to unpack .../virtualbox_4.3.10-dfsg-1ubuntu3_amd64.deb ...
</span><span class='line'>Unpacking virtualbox (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Selecting previously unselected package virtualbox-dkms.
</span><span class='line'>Preparing to unpack .../virtualbox-dkms_4.3.10-dfsg-1ubuntu3_all.deb ...
</span><span class='line'>Unpacking virtualbox-dkms (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Selecting previously unselected package virtualbox-qt.
</span><span class='line'>Preparing to unpack .../virtualbox-qt_4.3.10-dfsg-1ubuntu3_amd64.deb ...
</span><span class='line'>Unpacking virtualbox-qt (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Processing triggers for man-db (2.6.7.1-1ubuntu1) ...
</span><span class='line'>Processing triggers for ureadahead (0.100.0-16) ...
</span><span class='line'>Processing triggers for hicolor-icon-theme (0.13-1) ...
</span><span class='line'>Processing triggers for shared-mime-info (1.2-0ubuntu3) ...
</span><span class='line'>Processing triggers for bamfdaemon (0.5.1+14.04.20140409-0ubuntu1) ...
</span><span class='line'>Rebuilding /usr/share/applications/bamf-2.index...
</span><span class='line'>Processing triggers for desktop-file-utils (0.22-1ubuntu1) ...
</span><span class='line'>Processing triggers for mime-support (3.54ubuntu1.1) ...
</span><span class='line'>Processing triggers for gnome-menus (3.10.1-0ubuntu2) ...
</span><span class='line'>Setting up virtualbox (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'> * Stopping VirtualBox kernel modules                                                                                                                                                                 [ OK ] 
</span><span class='line'> * Starting VirtualBox kernel modules                                                                                                                                                                         * No suitable module for running kernel found
</span><span class='line'>                                                                                                                                                                                                      [fail]
</span><span class='line'>invoke-rc.d: initscript virtualbox, action "restart" failed.
</span><span class='line'>Processing triggers for ureadahead (0.100.0-16) ...
</span><span class='line'>Setting up virtualbox-dkms (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Loading new virtualbox-4.3.10 DKMS files...
</span><span class='line'>First Installation: checking all kernels...
</span><span class='line'>Building only for 3.13.0-46-generic
</span><span class='line'>Building initial module for 3.13.0-46-generic
</span><span class='line'>Done.
</span><span class='line'>
</span><span class='line'>vboxdrv:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>vboxnetadp.ko:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>vboxnetflt.ko:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>vboxpci.ko:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>depmod....
</span><span class='line'>
</span><span class='line'>DKMS: install completed.
</span><span class='line'> * Stopping VirtualBox kernel modules         [ OK ]
</span><span class='line'> * Starting VirtualBox kernel modules         [ OK ]
</span><span class='line'>Setting up virtualbox-qt (4.3.10-dfsg-1ubuntu3) ...</span></code></pre></td></tr></table></div></figure>


<p>这个时候virtualbox可以启动了。但是建立了虚拟机后，启动虚拟系统时提示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VT-x is disabled in the BIOS </span></code></pre></td></tr></table></div></figure>


<p>解决方法:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>重启系统
</span><span class='line'>长按 DEL 进入 BIOS
</span><span class='line'>方向键切到 BIOS Features
</span><span class='line'>选中如下选项
</span><span class='line'>Intel Virtualization Technology
</span><span class='line'>
</span><span class='line'>选择 Enable
</span><span class='line'>按下 F10 保存并重启</span></code></pre></td></tr></table></div></figure>


<p>因为各个机器的bios设置并不相同，请根据自己电脑的设置查找“Intel Virtualization Technology”, 大部分电脑默认是Disable的。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu上从源码编译chromium浏览器]]></title>
    <link href="http://mogoweb.net/blog/2014/12/15/build-chromium-browser-from-source/"/>
    <updated>2014-12-15T15:09:43+08:00</updated>
    <id>http://mogoweb.net/blog/2014/12/15/build-chromium-browser-from-source</id>
    <content type="html"><![CDATA[<p>Ubuntu不仅是一个免费且开源的操作系统，而且其平台也是开放且透明的。每个组件的源码都可以获取到，也可以从源码自己编译软件包。下面就探讨一下在ubuntu下如何获取chromium源码，并编译Chromium Web Browser。</p>

<p>要从ubuntu的仓库下载源码并编译软件包，最方便的就是使用apt-build实用工具。在ubuntu的发布版本中，该实用工具并没有安装，您可以用如下命令安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install apt-build</span></code></pre></td></tr></table></div></figure>


<p>接下来就可以使用如下命令下载并build chromium browser了:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-build install chromium-browser</span></code></pre></td></tr></table></div></figure>


<p>因为我的ubuntu是64位系统(ubuntu 11.04 LTS 64bit)，所以出现了如下错误:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>E: There are problems and -y was used without --force-yes
</span><span class='line'>E: Failed to process build dependencies
</span><span class='line'>-----&gt; Updating package lists &lt;-----
</span><span class='line'>Ign file: apt-build Release.gpg
</span><span class='line'>Get:1 file: apt-build Release [107 B]                                                                                                                
</span><span class='line'>Ign file: apt-build/main TranslationIndex                                                                                                            
</span><span class='line'>Err file: apt-build/main i386 Packages                                                                                                               
</span><span class='line'>  File not found
</span><span class='line'>Ign file: apt-build/main Translation-en_US                                                                                                           
</span><span class='line'>Ign file: apt-build/main Translation-en                                                                                                              
</span><span class='line'>Get:2 http://mirrors.163.com precise-updates Release.gpg [198 B]                                                                                     
</span><span class='line'>Get:3 http://mirrors.163.com precise Release.gpg [198 B]                                                                                             
</span><span class='line'>Hit http://mirrors.163.com precise-updates Release                                                                                                   
</span><span class='line'>Hit http://mirrors.163.com precise Release                                                                                                           
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted Sources                                                                                        
</span><span class='line'>Get:4 http://dl.google.com stable Release.gpg [198 B]                                                                                                
</span><span class='line'>Get:5 http://archive.ubuntu.com precise Release.gpg [198 B]                                                                                          
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main Sources                                                                                              
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe Sources                                                                                          
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main amd64 Packages                                                                                       
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted amd64 Packages                                                                                 
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe amd64 Packages                                                                                   
</span><span class='line'>Get:6 http://ppa.launchpad.net precise Release.gpg [316 B]                                                                                           
</span><span class='line'>Get:7 http://extras.ubuntu.com precise Release.gpg [72 B]                                                                                            
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main i386 Packages                                                                                        
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted i386 Packages                                                                                  
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe i386 Packages                                                                                    
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main TranslationIndex                                                                                     
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted TranslationIndex                                                                               
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe TranslationIndex                                                                                 
</span><span class='line'>Hit http://mirrors.163.com precise/universe amd64 Packages                                                                                           
</span><span class='line'>Hit http://mirrors.163.com precise/universe i386 Packages                                                                                            
</span><span class='line'>Hit http://dl.google.com stable Release                                                                                                              
</span><span class='line'>Hit http://mirrors.163.com precise/universe TranslationIndex                                                                                         
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main Translation-en                                                                                       
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted Translation-en                                                                                 
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe Translation-en                                                                                   
</span><span class='line'>Hit http://mirrors.163.com precise/universe Translation-en                                                                                           
</span><span class='line'>Hit http://dl.google.com stable/main amd64 Packages                                                                                                  
</span><span class='line'>Hit http://archive.ubuntu.com precise Release                                                                                                        
</span><span class='line'>Hit http://dl.google.com stable/main i386 Packages                                                                                                   
</span><span class='line'>Hit http://ppa.launchpad.net precise Release                                                                                                         
</span><span class='line'>Ign http://dl.google.com stable/main TranslationIndex                                                                                                
</span><span class='line'>Hit http://extras.ubuntu.com precise Release                                                                                                         
</span><span class='line'>Get:8 http://security.ubuntu.com precise-security Release.gpg [198 B]                                                                                
</span><span class='line'>Hit http://archive.ubuntu.com precise/main Sources                                                                                                   
</span><span class='line'>Get:9 http://cn.archive.ubuntu.com precise Release.gpg [198 B]                                                                                       
</span><span class='line'>Hit http://ppa.launchpad.net precise/main Sources                                                                                                    
</span><span class='line'>Hit http://extras.ubuntu.com precise/main Sources                                                                                                    
</span><span class='line'>Hit http://security.ubuntu.com precise-security Release                                                                                              
</span><span class='line'>Hit http://archive.ubuntu.com precise/restricted Sources                                                                                             
</span><span class='line'>Hit http://ppa.launchpad.net precise/main amd64 Packages                                                                                    
</span><span class='line'>Hit http://ppa.launchpad.net precise/main i386 Packages                                                                              
</span><span class='line'>Ign http://ppa.launchpad.net precise/main TranslationIndex                                                                           
</span><span class='line'>Hit http://extras.ubuntu.com precise/main amd64 Packages                                                                             
</span><span class='line'>Hit http://extras.ubuntu.com precise/main i386 Packages                                                                              
</span><span class='line'>Ign http://extras.ubuntu.com precise/main TranslationIndex                                                                           
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted Sources                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main Sources                                                      
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe Sources                                                                   
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise Release                                                                                   
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main amd64 Packages                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted amd64 Packages                                                                            
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe amd64 Packages                                                                              
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main i386 Packages                                                                                   
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted i386 Packages                                                                             
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe i386 Packages                                                                               
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main TranslationIndex                                                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted TranslationIndex                                                                          
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe TranslationIndex                                                                            
</span><span class='line'>Ign http://dl.google.com stable/main Translation-en_US                                                                                               
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main Translation-en                                                                                  
</span><span class='line'>Ign http://dl.google.com stable/main Translation-en                                                                                                  
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main Sources                                                                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted Translation-en                                                                            
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted Sources                                                                                          
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main amd64 Packages                                                                                         
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe Translation-en                                                                              
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted amd64 Packages                                                                                   
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main i386 Packages                                                                                          
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted i386 Packages                                                                                    
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main TranslationIndex                                                                                       
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted TranslationIndex                                                                                 
</span><span class='line'>Ign http://ppa.launchpad.net precise/main Translation-en_US                                                                                          
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main Translation-en                                                                                         
</span><span class='line'>Ign http://extras.ubuntu.com precise/main Translation-en_US                                                                                          
</span><span class='line'>Ign http://extras.ubuntu.com precise/main Translation-en                                                                                             
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted Translation-en                                                                                   
</span><span class='line'>Ign http://ppa.launchpad.net precise/main Translation-en                                                                                             
</span><span class='line'>Fetched 1,576 B in 10s (147 B/s)                                                                                                                     
</span><span class='line'>W: Failed to fetch file:/var/cache/apt-build/repository/dists/apt-build/main/binary-i386/Packages  File not found</span></code></pre></td></tr></table></div></figure>


<p>从网上找到了答案，解决方法就是指定配置文件中的架构：修改<em>/etc/apt/sources.list.d/apt-build.list</em>文件，将其中的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>deb file:/var/cache/apt-build/repository apt-build main</span></code></pre></td></tr></table></div></figure>


<p>替换为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>deb [arch=amd64] file:/var/cache/apt-build/repository apt-build main</span></code></pre></td></tr></table></div></figure>


<p>接下来就是下载源码，再经过漫长的build过程，生成并安装Chromium Web Browser。版本信息如下图:</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2014_chromium_for_linux_37.0.2062.120_info.png" alt="chrome://version" /></p>

<p>下载的源码位于<em>/var/cache/apt-build/build/</em>下：</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2014_chromium_ubuntu_source_info.png" alt="" /></p>

<p>从上图中可以看到源码包的大小只有200多M，而我们从chromium开源项目下的源码通常有7、8个G，主要原因是这里下的源码是不带git和svn信息的，是纯粹的源代码。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在本地服务器上建立chromium镜像]]></title>
    <link href="http://mogoweb.net/blog/2014/12/09/mirror-chromium-to-local-server/"/>
    <updated>2014-12-09T21:59:27+08:00</updated>
    <id>http://mogoweb.net/blog/2014/12/09/mirror-chromium-to-local-server</id>
    <content type="html"><![CDATA[<p>Android 5.0发布了好长时间，一直都没有来得及研究。前两周终于将android 5.0源码下载了下来，大致看了一下代码。我所关注的并非Material Design，而是Android 5.0的web引擎。从Android 4.4开始，采用了chromium/blink内核，Android 5.0自然也不例外，只是chromium的版本升级到了37.0.2062.116。想到我的chromium webview项目，仍然采用的是34.0.1847，因此打算也将chromium版本进行一次升级。</p>

<p>因为可恶的GFW，下载代码及其不顺利，虽然有VPN，但是对于几十G的chromium下载量，下载速度太慢，而且git不支持断点续传。在折腾了两三个星期之后，决定在公司的服务器上建立chromium的镜像。不知道从哪个版本开始，gclient开始全面转向git。由于git的天然的分布式特点，这为完全镜像chromium源码库提供了便利。</p>

<p>chromium源码库是由chromium本身加上一堆第三方开源库组成，极其庞大。为此我写了一个脚本，放到了github上，有兴趣的可以访问<a href="https://github.com/mogoweb/chromium_mirror_script">chromium_mirror_script</a>项目，其中chromium_git_list.txt为所有的源码库列表，来自<a href="https://chromium.googlesource.com/">https://chromium.googlesource.com/</a>，随着时间的推移，这个列表也可能发生变化。</p>

<p>有了内部的chromium镜像后，我们可以修改.DEPS.git文件，将其中的git_url值替换为本地git地址，这样通过gclient下载，就是从本地镜像服务器上获取代码了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我的macos编程之旅-AutoLayout]]></title>
    <link href="http://mogoweb.net/blog/2014/11/10/my-macos-programming-life-3/"/>
    <updated>2014-11-10T09:00:17+08:00</updated>
    <id>http://mogoweb.net/blog/2014/11/10/my-macos-programming-life-3</id>
    <content type="html"><![CDATA[<p>开始了Mac OS编程之后，仿佛又回到了Visual Basic编程年代，拖拖拽拽几个控件，app的UI就设计好了。但我至今还记得当年面临一个头疼的问题，就是应用程序在不同分辨率下的展现问题。为什么会头疼呢？那时主流的屏幕分辨率是800x600，但有些更好的显示器分辨率为1024x768，如果我们按照1024x768的分辨率设计UI，那么在800x600的分辨率下就显示不全，如果按照800x600的分辨率设计UI，那在1024x768下就没法充分利用屏幕空间。所以当时的app通常会指定最佳分辨率，低了显示不全，高了就只利用屏幕的一部分空间。</p>

<p>回到<strong>365看图</strong>软件上来，按照IKImageViewDemo设计的UI，存在一个问题：当我拉大窗口，图片显示区域并不会随之变大，整个界面变得很不协调。原因呢在于UI采用了绝对布局，控件的大小和位置是固定的。当然我也可以通过编程的方式，根据窗口的大小，计算图片显示区域的大小，然后动态的设置大小和位置，但这比较繁琐。在Android中，通过设计出线性布局、相对布局等布局方式来解决这一问题，而绝对布局是不推荐使用的。Mac OS是如何解决这一难题的呢？答案就是AutoLayout。</p>

<h3>AutoLayout <sup>[1]</sup></h3>

<p>自动布局系统通过数学化描述元素之间的关系来布局应用程序用户界面。这种关系称作约束，可以定义在单个的元素上，也可以定义在元素之间。使用自动布局，您可以创建动态灵活的界面来适应窗口大小的改变、设备横竖屏变化，还可以应对本地化带来的麻烦。</p>

<p>约束是自动布局的基础，它描述了界面元素布局的规则，比如您可以创建一个约束指定元素的宽度，或者与另一个元素的水平距离。您也可以添加或者删除约束，甚至修改约束的属性，来改变界面布局。</p>

<p>当您添加了多个约束后，不可避免的可能会存在冲突。所以，在计算用户界面上元素的运行时位置时，自动布局系统会综合考虑所有的约束，然后找出一种最大满足所有约束的布局。</p>

<p>自动布局从XCode 5开始引入，适用于ios 6.0和mac os 10.7及以上系统。当一个新工程创建时，自动布局缺省是开启的。</p>

<h3>添加约束</h3>

<p>添加约束的最简单方法就是通过拖拽来完成，方法如下：按住Ctrl键，然后拖动画布上的控件，类似于创建outlet连接。您可以拖拽元素到自身、到容器，或者到另一个元素。</p>

<p><img src="http://mogoweb.qiniudn.com/mogoweb_2014_mac_autolayout_trailing_2x.png" alt="autolayout" /></p>

<p>如上图中，您可以根据需要选择&#8221;保持在容器垂直方向的中央“，也可以选择”尾部与容器保持一定的距离“。</p>

<p>在<strong>365看图</strong>中，我选择将IKImageView的四边与容器保持一定的距离，这样，当窗口放大和缩小时，IKImageView就能同步放大与缩小。</p>

<h3>更多</h3>

<p>关于约束，还有许多地方值得探讨：比如编辑/删除约束，多条约束出现冲突该如何处理，如何通过编程的方法增加约束，等等。现在我只使用了一个基础的用法，更多的资料，可以参考apple的一篇官方文档：<a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/AutolayoutPG/Introduction/Introduction.html">Auto Layout Guide</a>。</p>

<p>[1]  <a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/AutolayoutPG/Introduction/Introduction.html">https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/AutolayoutPG/Introduction/Introduction.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我的macos编程之旅-应用程序关联]]></title>
    <link href="http://mogoweb.net/blog/2014/11/05/my-macos-programming-life-2/"/>
    <updated>2014-11-05T08:55:21+08:00</updated>
    <id>http://mogoweb.net/blog/2014/11/05/my-macos-programming-life-2</id>
    <content type="html"><![CDATA[<p>对objective-c做了基础的入门之后，我就开始了<strong>365看图</strong>的开发。我个人偏好通过实战来掌握新知识，碰到问题后再来阅读相关的资料并解决问题。从苹果开发者网站找到了一个<a href="https://developer.apple.com/library/mac/samplecode/IKImageViewDemo/Introduction/Intro.html#//apple_ref/doc/uid/DTS10004049">IKImageViewDemo</a>示例，这个例子足够简单，也满足我要开发的<strong>365看图</strong>的基本功能。以IKImageViewDemo作为模板，<strong>365看图</strong>就有了显示、放大、缩小、旋转图片等功能。接下来需要实现一个功能：关联应用程序到图片类型。简单的说，就是在Finder中鼠标右键点击图片文件，能够选择<strong>365看图</strong>打开图片，或者将图片文件拖拽到<strong>365看图</strong>即打开。</p>

<h3>注册文档类型</h3>

<p>在Windows系统中，有一个叫做注册表的东东来集中管理文档类型和能够打开文档的应用程序列表，在Mac系统中，则是通过应用程序包中的info.plist。在info.plist中，声明应用程序能够处理的文档类型(通过文件名后缀)。在<strong>365看图</strong>项目中有一个ImageViewer-Info.plist的文件，内容如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;dict&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleDevelopmentRegion<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>zh_CN<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>    <span class="nt">&lt;key&gt;</span>CFBundleDocumentTypes<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;array&gt;</span>
</span><span class='line'>        <span class="nt">&lt;dict&gt;</span>
</span><span class='line'>            <span class="nt">&lt;key&gt;</span>CFBundleTypeExtensions<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>            <span class="nt">&lt;array&gt;</span>
</span><span class='line'>                <span class="nt">&lt;string&gt;</span>jpg<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>                <span class="nt">&lt;string&gt;</span>png<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/array&gt;</span>
</span><span class='line'>            <span class="nt">&lt;key&gt;</span>CFBundleTypeIconFile<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>            <span class="nt">&lt;string&gt;&lt;/string&gt;</span>
</span><span class='line'>            <span class="nt">&lt;key&gt;</span>CFBundleTypeRole<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>            <span class="nt">&lt;string&gt;</span>Viewer<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/dict&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/array&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleExecutable<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>${EXECUTABLE_NAME}<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleIconFile<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleIdentifier<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>com.mogoweb.${PRODUCT_NAME:rfc1034identifier}<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleInfoDictionaryVersion<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>6.0<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleName<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>${PRODUCT_NAME}<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundlePackageType<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>APPL<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleShortVersionString<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>1.0<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleSignature<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>????<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>CFBundleVersion<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>1<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>LSApplicationCategoryType<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>public.app-category.photography<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>LSMinimumSystemVersion<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>${MACOSX_DEPLOYMENT_TARGET}<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>NSHumanReadableCopyright<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>Copyright © 2014年 mogoweb. All rights reserved.<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>NSMainNibFile<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>MainMenu<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>  <span class="nt">&lt;key&gt;</span>NSPrincipalClass<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>  <span class="nt">&lt;string&gt;</span>NSApplication<span class="nt">&lt;/string&gt;</span>
</span><span class='line'><span class="nt">&lt;/dict&gt;</span>
</span><span class='line'><span class="nt">&lt;/plist&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中关键的地方在于:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;key&gt;</span>CFBundleDocumentTypes<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>    <span class="nt">&lt;array&gt;</span>
</span><span class='line'>        <span class="nt">&lt;dict&gt;</span>
</span><span class='line'>            <span class="nt">&lt;key&gt;</span>CFBundleTypeExtensions<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>            <span class="nt">&lt;array&gt;</span>
</span><span class='line'>                <span class="nt">&lt;string&gt;</span>jpg<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>                <span class="nt">&lt;string&gt;</span>png<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/array&gt;</span>
</span><span class='line'>            <span class="nt">&lt;key&gt;</span>CFBundleTypeIconFile<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>            <span class="nt">&lt;string&gt;&lt;/string&gt;</span>
</span><span class='line'>            <span class="nt">&lt;key&gt;</span>CFBundleTypeRole<span class="nt">&lt;/key&gt;</span>
</span><span class='line'>            <span class="nt">&lt;string&gt;</span>Viewer<span class="nt">&lt;/string&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/dict&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/array&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>指明了应用程序能够处理jpg, png为后缀的文件。</p>

<h3>获取文件名</h3>

<p>通过右键点击开启应用程序，app是如何得到这个文件名呢？请看下面的代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span> <span class="nf">application</span> <span class="o">:</span> <span class="p">(</span><span class="n">NSApplication</span><span class="o">*</span><span class="p">)</span> <span class="n">sender</span> <span class="nl">openFile</span> <span class="p">:</span> <span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span> <span class="n">pathname</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;application is asking to open %@&quot;</span><span class="p">,</span> <span class="n">pathname</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>调试技巧</h3>

<p>通过拖拽打开应用程序如何调试(比如在application:openFile中打断点)呢？方法如下：</p>

<ol>
<li>在Xcode中点击菜单 <strong>Product > Scheme > Edit Scheme</strong> ，在 <strong>Info</strong> 页修改 <strong>Lauch</strong> 选项为：<strong>Wait for executable to be launched</strong></li>
<li>在 application:openFile 方法中设置断点。</li>
<li>打开 <strong>Finder</strong>, 将图片文件拖拽到您的应用程序上。［注：您可以在XCode的<strong>Project Navigator</strong>中右键点击Porducts节点下的xxx.app，然后点击<strong>Show in Finder</strong>菜单项来定位你的app可执行文件的位置］</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我的macos编程之旅-Objective C入门]]></title>
    <link href="http://mogoweb.net/blog/2014/10/24/my-macos-programming-life-1/"/>
    <updated>2014-10-24T08:48:13+08:00</updated>
    <id>http://mogoweb.net/blog/2014/10/24/my-macos-programming-life-1</id>
    <content type="html"><![CDATA[<p>&lt;<Objective-C Programming>>这本书属于基础入门书，Part I和Part II的内容是C语言基础，直接略过，直接跳到“Part III Objective-C and Foundation”。由于已经有C/C++编程经验，看书时着重于Objective C和C++的不同之处。</p>

<p>Objective-C是在C语言的基础上添加面向对象特性发展而来，下面就看看Objective-C中的面向对象三大要素。</p>

<h2>1. 封装</h2>

<p>和C++、Java等面向对象语言不同，Objective-C中并没有定义private, protected, public关键字，所有数据成员（instance variable）
都是私有的，无法直接访问。例如如下类定义中，x是不能直接被外部访问的。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">Foo</span> : <span class="bp">NSObject</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">-(</span><span class="kt">int</span><span class="p">)</span> <span class="nf">f:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">x</span><span class="p">;</span>
</span><span class='line'><span class="p">-(</span><span class="kt">int</span><span class="p">)</span> <span class="nf">g:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">x</span><span class="o">:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">y</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">Foo</span>
</span><span class='line'><span class="k">@synthesize</span> <span class="n">y</span><span class="p">;</span>
</span><span class='line'><span class="p">-(</span><span class="kt">int</span><span class="p">)</span> <span class="nf">f:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">x</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-(</span><span class="kt">int</span><span class="p">)</span> <span class="nf">g:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">x</span><span class="o">:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">y</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>要访问类的数据成员，必须通过类的成员方法，最常见的就是称之为getter和setter的方法。为了简化存取方法，Objective-C引入了property概念。比如上面的代码中:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>定义了属性y，并在实现文件中使用如下代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@synthesize</span> <span class="n">y</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面的语句相当于为y定义了getter和setter方法，比如你可以通过y()返回属性值，setY()设置属性值。</p>

<p>同样的，成员方法也没有共有私有之分，所有成员方法都可以被外部访问。上述代码中成员方法前的“-”表示这是一个实例方法，如果为“+”表示类方法，等价于C++中的静态成员函数。如果要为类定义一个方法，又不希望被外部调用，该如何做到呢？解决的方法是不在头文件(.h)中定义，直接在实现文件(.m)中加入成员函数。是的，没错，Objective-C并不要求在头文件中列出所有的成员方法。</p>

<h2>2. 继承</h2>

<p>和C++不同的是，Objective-C是单根继承体系，所有的类都直接或间接继承自NSObject（注：Objective-C语言规范并没有规定这个根类的名字），这一点和Java类似。同样的，Objective-C不支持多继承。和Java语言中的接口类似的东西在Objective-C中被称作协议(protocol)。协议是一个方法声明的列表，有些方法是必须实现的，有些方法可以定义为可选的。和类一样，协议可以继承其它的协议。一个Objective-C类可以实现多个协议。值得一提的是，协议的名字可以和类名一样，比如NSObject是一个类，同时还存在一个名为NSObject的协议。因为采用了不同的关键字，所以编译器能够区分。比如下面的代码中，Foo继承NSObject类，同时实现了NSObject协议：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">Foo</span> : <span class="bp">NSObject</span> <span class="o">&lt;</span><span class="bp">NSObject</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>在C++和Java中，父类可以控制成员方式是否被子类覆盖（通过virtual/final关键字)，在Objective-C中，只要子类的成员方法和父类完全一样（包括参数个数及类型），就会覆盖父类的成员方法。</p>

<h2>3. 多态</h2>

<p>Objective-C支持多态，而且不像C++那么复杂，比如C++中，如果使用栈变量实例，是无法达到多态效果的。关于Objective-C的多态，可通过下面的代码实例说明：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">Person</span> : <span class="bp">NSObject</span> <span class="p">{</span>
</span><span class='line'>    <span class="bp">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setName:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">name</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">Person</span>
</span><span class='line'><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setName:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">nameValue</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">nameValue</span><span class="p">;</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Person&#39;s name:%@&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="nc">Student</span> : <span class="nc">Person</span>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">Student</span>
</span><span class='line'><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setName:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">nameValue</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">nameValue</span><span class="p">;</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Student&#39;s name:%@&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">@autoreleasepool</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Person</span><span class="o">*</span> <span class="n">person</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Student</span> <span class="n">alloc</span><span class="p">]</span><span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">person</span> <span class="nl">setName</span><span class="p">:</span><span class="s">@&quot;Student A&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>4. 小结</h2>

<p>Objective-C支持面向对象的编程，同时又没有C++的多继承、虚继承等复杂的概念，如果之前有过C++/Java等编程经验，会很容易就能理解Objective-C中的面向对象编程，学起来也会非常轻松。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我的macos编程之旅]]></title>
    <link href="http://mogoweb.net/blog/2014/10/23/my-macos-programming-life/"/>
    <updated>2014-10-23T08:43:39+08:00</updated>
    <id>http://mogoweb.net/blog/2014/10/23/my-macos-programming-life</id>
    <content type="html"><![CDATA[<p>自从购入iMac后，这台水果机一直就是我的专属机。女人天生就对电脑这种科技产品心存畏惧，老婆一看这台电脑不是熟悉的Windows系统，就摸都不想摸。直到有一天，老婆拿了一个拷贝有儿子照片的U盘，要用这台iMac浏览一下照片，因为这台iMac的屏幕够大，显示效果也好。于是我就让位让她操作一下。我指点了一下如何插入U盘，如何打开U盘里的内容，剩下的就交给老婆大人操作了。带着Windows下的操作方式，老婆双击打开了一张图片。嗯，不错，打开了第一张照片，效果相当清晰细腻，色彩鲜艳，不禁赞叹了一句：苹果电脑还是不错的。然后&hellip;下一张，怎么浏览下一张图片？按右箭头没有用，界面上也没有浏览下一张的按钮。（注：默认是系统自带的“预览”程序）</p>

<p>我解释，苹果电脑要这么用：首先将要照片导入iPhoto，然后通过iPhoto浏览。老婆睁大眼睛，为什么要导入，我仅仅想浏览一下照片而已。我意识到，和她解释苹果软件的设计理念、照片管理的理论是徒劳的，于是我又告诉她一个新方法：选择所有照片，然后从右键菜单选择“打开”。老婆还是瞪着我：为什么要先选择所有照片？看到照片，第一反应就是双击打开它。我哑口无言&hellip;至此，老婆对苹果电脑的一点好感荡然无存。</p>

<p>我有点不服气，mac下的软件那么多，总有一款适合Mac新手，于是到mac appstore上去找图形图像类软件。本来苹果电脑就是以优秀的图形处理能力见长，所以各种图像处理软件琳琅满目，但很遗憾没找到一款功能足够简单，满足我的需求的软件。我在windows下常用的“光影看图”也没出Mac版。作为一个多年的程序员，当然不满足于这样一种结果。既然找不到这样的软件，就自己动手，风衣足食，好歹自己也是写程序维生的。某位国外大神级人物曾经有一个惊人的论调：每半年就要学习一门新的语言。对此我很惭愧，已经有多年围着C++/Java打转，没有去尝试学一门新的语言了。正好以此为契机，开始掌握一门新的技能吧。</p>

<p>Mac OS下开发，Objective-C是当仁不让的No.1，当然今年的兵器普上出现了新面孔Swift。考虑到我在C/C++圈子摸爬滚打了这么多年，估计用Objective C会更称手一些吧。而且Objective C发展了二十多年，一直由苹果独立支撑，竟然在编程语言兵器普上排在前几位，自然有其过人之处。好吧，就选它了。学习一门新的语言，一本经典的入门书籍那是必须的，经过大牛的推荐，我选择了&lt;<Objective-C Programming - The Big Nerd Ranch Guide>>。</p>

<p>下面就开始我的mac os编程之旅吧！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[读『MacTalk.人生元编程』]]></title>
    <link href="http://mogoweb.net/blog/2014/06/22/reading-about-macktalk/"/>
    <updated>2014-06-22T21:51:17+08:00</updated>
    <id>http://mogoweb.net/blog/2014/06/22/reading-about-macktalk</id>
    <content type="html"><![CDATA[<p>最先我是在多看上购买的电子版&lt;&lt;MacTalk.人生元编程>>，不久印刷版本也出来了。出于对这本书的喜爱，毫不犹豫的购买了印刷版本。为什么喜欢这本书，因为这本书写的有趣，我也希望我的博文写的有趣一点，可是翻出我以前和现在写的文章，都干巴巴的。不由的感叹，没有平日的文学修养，要将文章写的好真难。平日就欣赏那些语句优美的文章，碰上有文采、技术又出众的双料王，更是打心底佩服，自然要支持一下作者。</p>

<p>&lt;&lt;MacTalk.人生元编程>>是一本既有趣，又有不少干货的一本书。这本书的内容提要是这样概括这本书的:</p>

<p>『作者以一个70后程序员的笔触，立于Mac之上，讲述技术与人文的故事，有历史，有明天，有技术，有人生。70多篇文章划分为六大主题：Mac、程序员与编程、科技与人文、人物、工具、职场。篇篇独立成文，可拆可合，随时阅读。』</p>

<p>同样作为70后程序员，阅读这本随笔文笔容易引起共鸣（虽然地位悬殊，人家已经是院长，我还战斗在第一线）。有时读了某篇文章，不禁假想，要是我早几年读了它，是不是会走上另外一条路线。谈到这里，大家千万不要认为这是一本心灵鸡汤，作者只是以自己的经历、体会娓娓道来，从来不会将自己的观点强加于人。处在互联网这个乌烟瘴气的环境下，看到太多的争论与谩骂，不由令人心生悲观。好在还有池老师这样的技术专家，给浮躁的互联网吹进一丝清爽的凉风。本书最吸引我的地方在于文风幽默，我读过多个多个版本的Mac历史，这里是唯一写的既有趣，又让人涨见识的。关于职场与人生等话题，就如同一位老大哥在与你促膝长谈，不会给你讲为了祖国、为了人民这样的大道理，风趣而又能点中要害。</p>

<p>当然，这本书并非仅仅是一本IT人文书，中间还穿插了不少知识，主要是与Mac有关，此君也自称Mac君，算得上一名苹果公司免费的Mac布道师。文章并未涉及具体的编程知识，而是介绍一些提高效率的知识点。读了此书，Mac功力至少可以精进三层。另外，本文集还收录了VIM、Shell系列，同样适合linux程序员。在此书的发布会上，三表（微信公众号：三表龙门阵的作者）就打趣说，这本数应该拆成两本的，一本人文，一本技术，各取所需。</p>

<p>印刷版比电子版增加了职场系列、编程与写作等内容，这也算的上一份惊喜。印刷版的封面和正文版式都设计的简洁大方，并非仅仅将电子版印刷到纸张上。所以说，即使购买了电子版，再购买印刷版，丝毫不觉得吃亏，反而觉得物超所值。另外，如果您既不想花钱买印刷版，也不想花钱买电子版，可以上<a href="http://macshuo.com">http://macshuo.com</a>，可以免费阅读。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于Chromium WebView项目的源代码管理]]></title>
    <link href="http://mogoweb.net/blog/2014/06/19/about-source-management-of-chromium-webview/"/>
    <updated>2014-06-19T10:53:25+08:00</updated>
    <id>http://mogoweb.net/blog/2014/06/19/about-source-management-of-chromium-webview</id>
    <content type="html"><![CDATA[<p>chromium项目可谓开源项目集大成者，里面使用的第三方开源库数目高达60+。为了应对庞大的代码库管理问题，chromium项目引入了<a href="http://code.google.com/p/gclient/">gclient</a>，一套开源的代码管理方案。gclient是一套python脚本，用来简化多个git/svn源码库的管理。本文不探讨gclient的使用、配置，而是谈谈chromium webview项目是如何组织源码库的。</p>

<p>由于历史原因，chromium项目本身及许多第三方开源库采用的是SVN源码管理系统。SVN采用的是集中式管理，不如git那样能否方便的clone代码库。虽然google后来使用了git-svn等手段，为chromium和所有第三方开源库都做了git镜像库，但是如果需要获取某个release分支的代码，还是需要走svn（google也在不断改进，期望不久的将来，可以通过git获取某个release版本的源码）。</p>

<!--more-->


<p>基于chromium的开源项目有三种组织源码方案：</p>

<ol>
<li><a href="http://code.google.com/p/chromiumembedded">CEF</a>开源项目本身没有放chromium源码，只是提供了一套脚本，从google的服务器上去获取对应的源码，对chromium所做的修改以patch提交，同样提供了脚本应用这些patch。有了自动化脚本，开发人员其实也不关心代码托管在何处，项目组也可以省掉同步chromium源码的工作。但这种方案对项目组人员要求较高，必须要有扎实的脚本语言开发功底，每次对chromium的修改都必须做patch，也很考研开发人员的细致与耐心程度。</li>
<li><a href="https://www.codeaurora.org/xwiki/bin/Chromium+for+Snapdragon/WebHome">Chromium Browser for Snapdragon Project</a>开源项目为所有chromium及第三方开源库都做了git镜像，对chromium的修改直接提交到这些镜像库上。这种方案的优点是可控，非常适合企业内部开发，在企业内部部署，开发人员就无需每人都从外部下载，涉及到技术保密的提交也无需让外界知晓。但这种方案的缺点也是非常明显的，为60+个git库做镜像，有一定的工作量，还要定期同步，需要处理内部提交与外部提交合并问题。</li>
<li><a href="https://crosswalk-project.org/">crosswalk</a>开源项目只镜像了chromium/blink/v8等少量几个会修改的开源库，其它的库则从google的网站上取。这种方案在维护与便捷之间做了最佳平衡，因为chromium项目使用了大量的第三方开源库，但我们极少有需要去修改这些第三方开源库，处于定制和优化的目的，我们通常也只在chromium/blink库上修改代码。</li>
</ol>


<p>Chromium WebView项目采用了第三种方案，由于chromium和blink这两个库太庞大，屡次上传到github都失败，于是改成从crosswalk项目clone相关的代码库。所以在我的名下多了chromium-crosswalk, blink-crosswalk, v8-crosswalk这几个库，其实它们都是为chromium webview项目服务的，里面包含了crosswalk项目的代码，可以忽略之。</p>

<p>[注: 由于一些原因，在国内访问chromium的源码库不再顺畅了，免费的翻墙服务GAE也被屏蔽了，所以要同步代码，还需要购买商业的VPN，以保证网络是通畅的。您也可以从Chromium Browser for Snapdragon Project获取相关的git库，只要版本取的正确，可以同样使用。]</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用pandoc和markdown书写文档]]></title>
    <link href="http://mogoweb.net/blog/2014/06/16/writing-document-with-pandoc-and-markdown/"/>
    <updated>2014-06-16T14:37:47+08:00</updated>
    <id>http://mogoweb.net/blog/2014/06/16/writing-document-with-pandoc-and-markdown</id>
    <content type="html"><![CDATA[<p>公司决定以后使用markdown+pandoc书写文档，于是就研究了一下markdown的写作（补充一下：markdown是一种标记语言，而pandoc则是转化工具）。虽然使用word书写文档得到大多数程序员的鄙视，但不得不承认，Word书写文档最直观，门槛最低。使用markdown+pandoc，各种问题层出不穷，以至于无法参照某一个文档搞定所有问题。在折腾了一天、google了各种中英文资料后，终于打通各路神仙。特此撰文一篇，如有雷同，纯属复制。</p>

<!-- more -->


<h2>什么是Markdown</h2>

<p>Markdown 是一种轻量级标记语言，它允许人们『使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档”』。这种语言吸收了很多在电子邮件中已有的纯文本标记的特性。一份使用Markdown格式编写的文档应该可以直接以纯文本发布，而且看起来不会像是由许多标签惑是格式指令所构成。因此，Markdown的语法全由标点符号所组成，并经过严谨筛选，为了让它们看起来就像所要表达的意思。</p>

<p>Markdown语法请查看<a href="http://www.ituring.com.cn/article/504">Markdown语法说明（详解版）</a>, 或者完整的<a href="http://daringfireball.net/projects/markdown/syntax">Markdown语法</a>.</p>

<p>Markdown不是要来取代HTML，甚至也没有和它相似。它的语法种类不多，只和HTML的一部分有关。重点不是要创建一种更容易写作HTML文档的语法，Markdown的重点在于，它能让文档更容易阅读、编写。HTML是一种『发布』的格式，Markdown是一种『编写』的格式，因此，Markdown的格式语法只涵盖纯文本可以覆盖的范围。</p>

<p>不在Markdown涵盖范围之内的标签，都可以直接在文档里面用HTM撰写，不需要额外标注这是HTML或是Markdown。</p>

<h2>什么是pandoc</h2>

<p>Markdown自身的设计哲学决定了markdown并不适合编写复杂的文档。但各路大神都觉得markdown是个好东西，不够用怎么办，扩充呗。于是，我们可以看到github flavored markdown、multimarkdown、maruku等各路扩展。Markdown文档写完了，该如何展现给别人呢，总不至于丢给您的客户一个markdown文本文档，说您就将就着看吧。所以markdown文档最终还是会转换为html、word、pdf等格式，这时就需要一个强大的转换工具，不仅能转成各种格式，还需要转换的漂亮。</p>

<p>pandoc是开源界传说中的高帅富社区-haskell社区的作品，一方面它定义了markdown扩展，另一方面其转换功能强大的令人发指，支持众多的输入和输出格式（markdown只是其中一种）。使用</p>

<pre><code>pandoc --help
</code></pre>

<p>可以看到pandoc主要支持的输入与输出格式：</p>

<pre><code>input formats:  docbook, haddock, html, json, latex, markdown, markdown_github,
                markdown_mmd, markdown_phpextra, markdown_strict, mediawiki,
                native, opml, org, rst, textile
Output formats: asciidoc, beamer, context, docbook, docx, dzslides, epub, epub3,
                fb2, html, html5, icml, json, latex, man, markdown,
                markdown_github, markdown_mmd, markdown_phpextra,
                markdown_strict, mediawiki, native, odt, opendocument, opml,
                org, pdf*, plain, revealjs, rst, rtf, s5, slideous, slidy,
                texinfo, textile
                [*for pdf output, use latex or beamer and -o FILENAME.pdf]
</code></pre>

<p>上述语言的互转关系，可以看看作者制作的<a href="http://johnmacfarlane.net/pandoc/diagram.png">这份壮观的图</a>，从中可以看出Pandoc的强大。这年头，哲学系教授会写程序，还是Haskell，伤不起啊:D</p>

<h2>Ubuntu环境配置篇</h2>

<p>主机环境：Ubuntu 12.04 LTS 64位</p>

<h3>markdown编辑器</h3>

<p>因为是纯文本格式写作，理论上任何文本编辑器，如VIM、gedit，都可以胜任此项工作。不过考虑到大多数人希望所见及所得的编辑效果（要不Microsoft Word就不会这么流行了），还是推荐使用具有图形界面并带预览功能的编辑器，如ubuntu下的retext。</p>

<h4>retext</h4>

<pre><code>1. sudo apt-get install retext
2. retext&amp;
3. 界面如下图所示：
</code></pre>

<p><img src="http://mogoweb.qiniudn.com/mogoweb_2014_retext_markdown_ui.png" alt="retext ui" /></p>

<h3>安装pandoc</h3>

<pre><code>sudo apt-get autoremove pandoc      #删掉之前的pandoc安装
sudo apt-get install cabal-install  #安装Haskell包管理器
cabal update                        #获取Haskell包信息
cabal install pandoc                #通过cabal安装pandoc
</code></pre>

<p>然后再把~/.cabal加到路径中去，在.bashrc里加上一句</p>

<pre><code>export PATH=$HOME/.cabal/bin:$PATH
</code></pre>

<p>如果在安装过程中出现：</p>

<pre><code>setup: The program alex is required but it could not be found.
cabal: Error: some packages failed to install:
pandoc-1.12.4.2 failed during the configure step. The exception was:
ExitFailure 1
</code></pre>

<p>执行如下命令安装软件包</p>

<pre><code>cabal install alex
cabal install happy
</code></pre>

<p>如果安装pandoc仍提示错误，修改环境变量：</p>

<pre><code>export PATH=/home/alex/.cabal/bin:$PATH
</code></pre>

<h3>安装之后的校验</h3>

<p>打开Shell，输入：</p>

<pre><code>pandoc --version
</code></pre>

<p>如果安装无误，应能看到pandoc相关的作者、版权、序列许可等信息。</p>

<h3>安装LaTex</h3>

<pre><code>sudo apt-get install texlive texlive-latex-extra texlive-latex-recommended texlive-xetex
</code></pre>

<p>这个过程会下载大约七八百兆的包，可以先喝杯咖啡，活动一下筋骨。</p>

<h3>安装中文字体</h3>

<p>可以用“fc-list&#8221;命令查看已安装字体。如果没有中文字体，或者缺少某些中文字体，使用如下命令安装gnome中文字体。</p>

<pre><code>apt-get install apt-get install language-pack-gnome-zh*
</code></pre>

<p>如果有ttf文件，比如Windows的字体文件在（Windows fonts）下，双击即可安装。</p>

<h3>输出pdf格式</h3>

<pre><code>pandoc  test.markdown -o test.pdf --latex-engine=xelatex -V mainfont=文泉驿微米黑
</code></pre>

<p>需要注意，mainfont需要指定系统存在的字体，否则中文会变成空格。</p>

<h3>设定边界、中文换行</h3>

<p>使用前一步骤生成的pdf文件，边界过大，中文换行也存在问题，这时需要pandoc模板上场了。其实系统中已经存在针对不同格式转换的模板了，位于$HOME/.cabal/share/pandoc-1.12.4.2/data/templates下，针对lextex的模板为default.latex。可以修改这个系统模板，也可以自己创建一个，然后在执行pandoc时指定模板。建议采用自定义模板的方式，针对不同的格式要求定义模板。以下就是我定义的模板文件template.tex:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>\documentclass[$if(fontsize)$$fontsize$,$endif$$if(lang)$$lang$,$endif$$if(papersize)$$papersize$,$endif$$for(classoption)$$classoption$$sep$,$endfor$]{$documentclass$}
</span><span class='line'>\usepackage{geometry}       % 設定邊界
</span><span class='line'>\geometry{
</span><span class='line'>  top=1in,
</span><span class='line'>  inner=1in,
</span><span class='line'>  outer=1in,
</span><span class='line'>  bottom=1in,
</span><span class='line'>  headheight=3ex,
</span><span class='line'>  headsep=2ex
</span><span class='line'>}
</span><span class='line'>$if(fontfamily)$
</span><span class='line'>\usepackage{$fontfamily$}
</span><span class='line'>$else$
</span><span class='line'>\usepackage{lmodern}
</span><span class='line'>$endif$
</span><span class='line'>$if(linestretch)$
</span><span class='line'>\usepackage{setspace}
</span><span class='line'>\setstretch{$linestretch$}
</span><span class='line'>$endif$
</span><span class='line'>\usepackage{amssymb,amsmath}
</span><span class='line'>\usepackage{ifxetex,ifluatex}
</span><span class='line'>\usepackage{fixltx2e} % provides \textsubscript
</span><span class='line'>\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
</span><span class='line'>  \usepackage[T1]{fontenc}
</span><span class='line'>  \usepackage[utf8]{inputenc}
</span><span class='line'>$if(euro)$
</span><span class='line'>  \usepackage{eurosym}
</span><span class='line'>$endif$
</span><span class='line'>\else % if luatex or xelatex
</span><span class='line'>  \usepackage{fontspec}     % 允許設定字體
</span><span class='line'>  \usepackage{xeCJK}        % 分開設置中英文字型
</span><span class='line'>  \setCJKmainfont{文泉驿微米黑}    % 設定中文字型
</span><span class='line'>  \setmainfont{Droid Serif}     % 設定英文字型
</span><span class='line'>  \setromanfont{Droid Serif}    % 字型
</span><span class='line'>  \setmonofont{Droid Sans Mono}
</span><span class='line'>  \linespread{1.2}\selectfont   % 行距
</span><span class='line'>  \XeTeXlinebreaklocale "zh"    % 針對中文自動換行
</span><span class='line'>  \XeTeXlinebreakskip = 0pt plus 1pt % 字與字之間加入0pt至1pt的間距，確保左右對整齊
</span><span class='line'>  \parindent 0em        % 段落縮進
</span><span class='line'>  \setlength{\parskip}{20pt}    % 段落之間的距離
</span><span class='line'>  \ifxetex
</span><span class='line'>    \usepackage{xltxtra,xunicode}
</span><span class='line'>  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
</span><span class='line'>  \newcommand{\euro}{€}
</span><span class='line'>$if(mainfont)$
</span><span class='line'>    \setmainfont{$mainfont$}
</span><span class='line'>$endif$
</span><span class='line'>$if(sansfont)$
</span><span class='line'>    \setsansfont{$sansfont$}
</span><span class='line'>$endif$
</span><span class='line'>$if(monofont)$
</span><span class='line'>    \setmonofont[Mapping=tex-ansi]{$monofont$}
</span><span class='line'>$endif$
</span><span class='line'>$if(mathfont)$
</span><span class='line'>    \setmathfont(Digits,Latin,Greek){$mathfont$}
</span><span class='line'>$endif$
</span><span class='line'>\fi
</span><span class='line'>% use upquote if available, for straight quotes in verbatim environments
</span><span class='line'>\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
</span><span class='line'>% use microtype if available
</span><span class='line'>\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
</span><span class='line'>$if(geometry)$
</span><span class='line'>\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
</span><span class='line'>$endif$
</span><span class='line'>$if(natbib)$
</span><span class='line'>\usepackage{natbib}
</span><span class='line'>\bibliographystyle{$if(biblio-style)$$biblio-style$$else$plainnat$endif$}
</span><span class='line'>$endif$
</span><span class='line'>$if(biblatex)$
</span><span class='line'>\usepackage{biblatex}
</span><span class='line'>$if(biblio-files)$
</span><span class='line'>\bibliography{$biblio-files$}
</span><span class='line'>$endif$
</span><span class='line'>$endif$
</span><span class='line'>$if(listings)$
</span><span class='line'>\usepackage{listings}
</span><span class='line'>$endif$
</span><span class='line'>$if(lhs)$
</span><span class='line'>\lstnewenvironment{code}{\lstset{language=Haskell,basicstyle=\small\ttfamily}}{}
</span><span class='line'>$endif$
</span><span class='line'>$if(highlighting-macros)$
</span><span class='line'>$highlighting-macros$
</span><span class='line'>$endif$
</span><span class='line'>$if(verbatim-in-note)$
</span><span class='line'>\usepackage{fancyvrb}
</span><span class='line'>$endif$
</span><span class='line'>$if(tables)$
</span><span class='line'>\usepackage{longtable,booktabs}
</span><span class='line'>$endif$
</span><span class='line'>$if(graphics)$
</span><span class='line'>\usepackage{graphicx}
</span><span class='line'>\makeatletter
</span><span class='line'>\def\maxwidth{\ifdim\Gin@nat@width&gt;\linewidth\linewidth\else\Gin@nat@width\fi}
</span><span class='line'>\def\maxheight{\ifdim\Gin@nat@height&gt;\textheight\textheight\else\Gin@nat@height\fi}
</span><span class='line'>\makeatother
</span><span class='line'>% Scale images if necessary, so that they will not overflow the page
</span><span class='line'>% margins by default, and it is still possible to overwrite the defaults
</span><span class='line'>% using explicit options in \includegraphics[width, height, ...]{}
</span><span class='line'>\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
</span><span class='line'>$endif$
</span><span class='line'>\ifxetex
</span><span class='line'>  \usepackage[setpagesize=false, % page size defined by xetex
</span><span class='line'>              unicode=false, % unicode breaks when used with xetex
</span><span class='line'>              xetex]{hyperref}
</span><span class='line'>\else
</span><span class='line'>  \usepackage[unicode=true]{hyperref}
</span><span class='line'>\fi
</span><span class='line'>\hypersetup{breaklinks=true,
</span><span class='line'>            bookmarks=true,
</span><span class='line'>            pdfauthor={$author-meta$},
</span><span class='line'>            pdftitle={$title-meta$},
</span><span class='line'>            colorlinks=true,
</span><span class='line'>            citecolor=$if(citecolor)$$citecolor$$else$blue$endif$,
</span><span class='line'>            urlcolor=$if(urlcolor)$$urlcolor$$else$blue$endif$,
</span><span class='line'>            linkcolor=$if(linkcolor)$$linkcolor$$else$magenta$endif$,
</span><span class='line'>            pdfborder={0 0 0}}
</span><span class='line'>\urlstyle{same}  % don't use monospace font for urls
</span><span class='line'>$if(links-as-notes)$
</span><span class='line'>% Make links footnotes instead of hotlinks:
</span><span class='line'>\renewcommand{\href}[2]{#2\footnote{\url{#1}}}
</span><span class='line'>$endif$
</span><span class='line'>$if(strikeout)$
</span><span class='line'>\usepackage[normalem]{ulem}
</span><span class='line'>% avoid problems with \sout in headers with hyperref:
</span><span class='line'>\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
</span><span class='line'>$endif$
</span><span class='line'>\setlength{\parindent}{0pt}
</span><span class='line'>\setlength{\parskip}{6pt plus 2pt minus 1pt}
</span><span class='line'>\setlength{\emergencystretch}{3em}  % prevent overfull lines
</span><span class='line'>$if(numbersections)$
</span><span class='line'>\setcounter{secnumdepth}{5}
</span><span class='line'>$else$
</span><span class='line'>\setcounter{secnumdepth}{0}
</span><span class='line'>$endif$
</span><span class='line'>$if(verbatim-in-note)$
</span><span class='line'>\VerbatimFootnotes % allows verbatim text in footnotes
</span><span class='line'>$endif$
</span><span class='line'>$if(lang)$
</span><span class='line'>\ifxetex
</span><span class='line'>  \usepackage{polyglossia}
</span><span class='line'>  \setmainlanguage{$mainlang$}
</span><span class='line'>\else
</span><span class='line'>  \usepackage[$lang$]{babel}
</span><span class='line'>\fi
</span><span class='line'>$endif$
</span><span class='line'>
</span><span class='line'>$if(title)$
</span><span class='line'>\title{$title$}
</span><span class='line'>$endif$
</span><span class='line'>$if(subtitle)$
</span><span class='line'>\subtitle{$subtitle$}
</span><span class='line'>$endif$
</span><span class='line'>$if(author)$
</span><span class='line'>\author{$for(author)$$author$$sep$ \and $endfor$}
</span><span class='line'>$endif$
</span><span class='line'>$if(date)$
</span><span class='line'>\date{$date$}
</span><span class='line'>$endif$
</span><span class='line'>$for(header-includes)$
</span><span class='line'>$header-includes$
</span><span class='line'>$endfor$
</span><span class='line'>
</span><span class='line'>\begin{document}
</span><span class='line'>$if(title)$
</span><span class='line'>\maketitle
</span><span class='line'>$endif$
</span><span class='line'>$if(abstract)$
</span><span class='line'>\begin{abstract}
</span><span class='line'>$abstract$
</span><span class='line'>\end{abstract}
</span><span class='line'>$endif$
</span><span class='line'>
</span><span class='line'>$for(include-before)$
</span><span class='line'>$include-before$
</span><span class='line'>
</span><span class='line'>$endfor$
</span><span class='line'>$if(toc)$
</span><span class='line'>{
</span><span class='line'>\hypersetup{linkcolor=black}
</span><span class='line'>\setcounter{tocdepth}{$toc-depth$}
</span><span class='line'>\tableofcontents
</span><span class='line'>}
</span><span class='line'>$endif$
</span><span class='line'>$body$
</span><span class='line'>
</span><span class='line'>$if(natbib)$
</span><span class='line'>$if(biblio-files)$
</span><span class='line'>$if(biblio-title)$
</span><span class='line'>$if(book-class)$
</span><span class='line'>\renewcommand\bibname{$biblio-title$}
</span><span class='line'>$else$
</span><span class='line'>\renewcommand\refname{$biblio-title$}
</span><span class='line'>$endif$
</span><span class='line'>$endif$
</span><span class='line'>\bibliography{$biblio-files$}
</span><span class='line'>
</span><span class='line'>$endif$
</span><span class='line'>$endif$
</span><span class='line'>$if(biblatex)$
</span><span class='line'>\printbibliography$if(biblio-title)$[title=$biblio-title$]$endif$
</span><span class='line'>
</span><span class='line'>$endif$
</span><span class='line'>$for(include-after)$
</span><span class='line'>$include-after$
</span><span class='line'>
</span><span class='line'>$endfor$
</span><span class='line'>\end{document}</span></code></pre></td></tr></table></div></figure>


<p>使用如下命令生成pdf文档：</p>

<pre><code>pandoc test.md -o test.pdf --latex-engine=xelatex --template=/home/alex/template.tex
</code></pre>

<h2>参考文档</h2>

<ol>
<li><a href="http://www.cnblogs.com/liuyangnuts/archive/2013/04/23/3038354.html">让pandoc输出pdf时支持中文</a></li>
<li><a href="http://www.yangzhiping.com/tech/pandoc.html">Markdown写作进阶：Pandoc入门浅谈</a></li>
<li><a href="http://johnmacfarlane.net/pandoc/demo/example3.html">Pandoc User’s Guide</a></li>
<li><a href="http://stackoverflow.com/">stackoverflow</a></li>
<li><a href="http://blog.csdn.net/phodal/article/details/23381821">pandoc 用markdown写毕业论文 markdown转pdf,docx</a></li>
<li><a href="http://higrid.net/c-art-pandoc_command.htm">利用Pandoc转换markdown和HTML、LaTeX</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于chromium_webview项目]]></title>
    <link href="http://mogoweb.net/blog/2014/06/10/about-chromium-webview-project/"/>
    <updated>2014-06-10T08:56:06+08:00</updated>
    <id>http://mogoweb.net/blog/2014/06/10/about-chromium-webview-project</id>
    <content type="html"><![CDATA[<p>chromium_webview的目标是在chromium核心的基础上提供Android WebView API全兼容的接口，希望达到的效果是基于Android WebView API开发的应用程序，只需将android.webkit包名替换为com.mogoweb.chrome即可完成从WebKit内核到Chromium内核的迁移。目标支持平台为Android 4.0以上。项目地址：<a href="https://github.com/mogoweb/chromium_webview">https://github.com/mogoweb/chromium_webview</a>。</p>

<h2>项目的起源</h2>

<p>从2011年开始，我转向从事chromium的定制化工作。2012年在移动手机平台上开发了一款浏览器Browser1.0，基于WebKit内核和Android WebView API。2012年下半年开始进行chromium的移植工作，其时google发布了Chrome for Android的第一个版本V0.16，还是beta版本。虽然浏览器的内核发生了很大的变化，但是我们期望上层的代码不需要做修改，于是在Content API的基础上，按照Android WebView API进行接口封装。最后做出来的浏览器美其名曰“双内核”，也就是WebKit加Chromium双内核。</p>

<!--more-->


<p>由于Chromium渲染架构的缘故，在Content API之上封装的WebView API还存在问题：</p>

<ol>
<li>为了启用硬件加速，chromium for android引入了SurfaceView，但SurfaceView动态添加会引起黑屏。所以SurfaceView必须在应用程序的初始化代码中添加，不能象Android WebView那样随心所欲的使用。</li>
<li>采用了多进程架构，后果之一就是内存狂飙，更让人难以接受的是，访问新浪首页这样复杂的网页，还不如WebKit浏览器流畅。</li>
</ol>


<p>在我们移植chromium的同时，google的工程师也没闲着，chromium代码下面开始出现android_webview的代码，接着代码越来越多，更新的也越来越频繁。有一天，在github上看到一个项目：<a href="https://github.com/pwnall/chromeview">ChromeView Project</a>。这正是我所需要的基于chromium的WebView API封装,但这哥们估计也没啥闲功夫，项目好久都没有更新。于是我就在github上创建了chromium_webview项目，早期的AwContents实现是软件渲染，所以效率低下。</p>

<p>时间推到2013年11月，Android 4.4发布，其中很大的一个变化就是使用chromium替换了原来的webkit引擎。于是我又开始哼哧哼哧研究起AOSP中的Chromium WebView实现，研究了AOSP中的Chromium WebView实现后，定下了如下策略：</p>

<ol>
<li>照搬WebViewChromium及相关代码，如果代码中使用了未公开的API，使用反射机制实现。</li>
<li>启用光栅化位图，消除对GraphicBuffer的依赖，从而不依赖系统的未公开C++接口。</li>
</ol>


<p>经过一段时间的工作，chromium webview项目终于完整支持硬件加速。</p>

<h2>Chromium WebView的应用场景</h2>

<p>有人要说了，现在Android系统都已经采用chromium引擎了，你还费老大劲整出这玩意儿，是不是吃饱了撑了。的确，做这个事情没给我带来一毛钱经济上的收益，反而搭进了我的业余休息时间，我做这件事的动力来自：</p>

<ol>
<li>Android WebView采用chromium引擎不假，但那也得4.4及以上的版本。</li>
<li>使用系统的WebView，失去了定制能力，比如要添加一个HTML标签就比较难。</li>
<li>提高水平，结交朋友。</li>
</ol>


<p>早些年做《无线城市》项目时，就发现Hybrid App还是有一些市场的。但使用系统的WebView可能存在性能低下、兼容性不良、无法定制的问题。所以chromium webview的最佳应用场景就是集成到APP作为渲染引擎，此外开发浏览器也是一个选择。</p>

<h2>Chromium WebView存在的问题</h2>

<p>Chromium WebView刚完成了初步的移植，问题还非常多，在后续的时间，将会继续完善。目前看来，仍然有几大难题难以解决：</p>

<ol>
<li>由于渲染架构的原因，在Android 4.0 &amp; Android 4.0.3上还只能使用软件方式渲染；</li>
<li>光栅化位图的效率似乎比GraphicBuffer的效率低一些，长网页或复杂网页在快速滚动时，会出现短暂的白屏。</li>
</ol>


<h2>后续计划</h2>

<ol>
<li>完善Chromium WebView API，修复BUG</li>
<li>开启WebGL支持</li>
<li>精简内核，优化内存占用</li>
<li>将开源浏览器TintBrowser改成使用Chromium WebView，证明基于WebView API的应用能够无缝迁移到Chromium WebView。</li>
</ol>


<h2>更新</h2>

<p>2014-08-18</p>

<p>完成TintBrowser在Chromium WebView上的适配，并修改了若干UI，命名为365浏览器，已经在腾讯开放平台上上架，你可以从<a href="http://android.myapp.com/myapp/detail.htm?apkName=com.mogoweb">这里</a>下载。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用iPhoto和微云管理照片]]></title>
    <link href="http://mogoweb.net/blog/2014/05/25/using-iphoto-and-weiyun-to-manage-photos/"/>
    <updated>2014-05-25T07:35:09+08:00</updated>
    <id>http://mogoweb.net/blog/2014/05/25/using-iphoto-and-weiyun-to-manage-photos</id>
    <content type="html"><![CDATA[<p>自从上次移动硬盘损坏，丢失了不少珍贵的照片，一直心有余悸，现在保存资料都会进行双备份。近一两年，云存储市场风起云涌，越来越多的企业加入战团。不仅免费，而且容量越来越大。当腾讯宣布微云免费容量10T后，我毫不犹豫的就申请了一个账号，将资料都保存在云端（基本上是一些照片和视频，对于普通老百姓，隐私从来都不是大事），形成本地和云端双保险。喜上加喜，近期新入手了一台iMac，Mac OS自带的iPhoto应用程序让人爱不释手，管理照片起来非常方便，可以直接导入RAW文件，还提供简单的编辑功能。但iPhoto通常是将相机照片导入到自己的库中，这样会出现iPhoto和微云两套照片，有点浪费空间。在琢磨了一段时间后，总结了一套自己的照片管理方法。</p>

<!--more-->


<p>首先，在微云文件夹里面，还是按照手工的方式整理文件夹，基本的目录命名原则是第一层目录为年份，在年份下面再根据日期和事件（或地点）建立子文件夹。单反拍的照片用RAW格式存储，将SD卡取下来，接到电脑上，将其中的照片文件复制到对应的子文件夹。这一步完成了数码照片在微云上的存储。RAW格式虽然方便后期处理，但是浏览起来不太方便，如果要发布到网上，或者传给他人，还是需要转成jpg格式才行，这时就需要iPhoto上场了。</p>

<p>接下来，打开iPhoto，点选菜单项“iPhoto ｜ 偏好设置“，在弹出的界面，点击“高级”选项卡，去掉“将项目拷贝到iPhoto图库“前面的勾，如下图所示：</p>

<p><img src="http://mogoweb.qiniudn.com/mogoweb_2014_iphoto_preferences.png" alt="偏好设置" /></p>

<p>修改这一设置的目的是不用将原始的RAW文件复制到iPhoto库，节省空间。然后点选菜单项“文件 ｜ 导入到图库“，选择微云目录下的照片，完成导入。这样如果要浏览照片，就可以在iPhoto中进行，大部分照片可以进行简单的修饰。如果需要复杂的修饰处理，可以打开PhotoShop，对微云下的RAW格式文件进行处理。</p>
]]></content>
  </entry>
  
</feed>
