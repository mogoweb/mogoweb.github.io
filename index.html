
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>放飞梦想</title>
	<meta name="author" content="mogoweb">

	
	<meta name="description" content="作为一个自认为苦逼的程序员，有一阵子曾考虑逃离程序世界，做一个文艺青年。你看，出去旅旅游、读读书、摄个影，没事发个呆，生活该是多么的惬意。反观程序员，每天对着冰冷的机器，有事无事还要加个班。正如一个段子所写： 你苦战通宵游戏时，布里斯班的灯鱼已划过珊瑚丛; 你赶场招聘会时， &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="放飞梦想" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">放飞梦想</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">首页</a></li>
    <li><a href="/mogo-browser/">365浏览器</li>
    <li><a href="/blog/archives">存档</a></li>
    <li><a href="/resources">资源</a></li>
    <li><a href="/about">关于</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">首页</a></li>
    <li><a href="/mogo-browser/">365浏览器</li>
    <li><a href="/blog/archives">存档</a></li>
    <li><a href="/resources">资源</a></li>
    <li><a href="/about">关于</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:mogoweb.net">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:mogoweb.net">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/11/13/reading-android-source-preface/">
		
			Android源码阅读与理解（一）：开篇</a>
	</h2>
	<div class="entry-content">
		<p>作为一个自认为苦逼的程序员，有一阵子曾考虑逃离程序世界，做一个文艺青年。你看，出去旅旅游、读读书、摄个影，没事发个呆，生活该是多么的惬意。反观程序员，每天对着冰冷的机器，有事无事还要加个班。正如一个段子所写：</p>

<blockquote><p>你苦战通宵游戏时，布里斯班的灯鱼已划过珊瑚丛;</p>

<p>你赶场招聘会时，蒙巴萨的小蟹刚溜出渔夫的掌心;</p>

<p>你写程序代码时，布拉格的电车正摇着铃晃过金色夕阳;</p>

<p>你挤进汹涌的食堂时，哥本哈根的街头画家完成了第99幅立体画。</p>

<p>有一些穿高跟鞋走不到的路，有一些喷着香水闻不到的空气，有一些在楼宇里永远碰遇不到的人。</p></blockquote>

<p>但是，看村上春书的《当我谈跑步时我谈些什么》如同嚼蜡，看侯孝贤、王家卫的电影直睡觉之后，我发现其实身上缺少文艺细胞，无事发呆更是让我难受。其实仔细想想，写代码时虽然苦逼，但是当纠出一个苦苦追寻了半个月的bug的时刻，内心还是感觉很爽的。不读村上春树，读读东野圭吾也挺开心的。每天充实的感觉比无所事事更舒服。所以，我还是需要做回自己，做自己喜欢、自己擅长的事情。读到池建强的《是旅行还是长跑》中这样一段话：</p>

<blockquote><p>只要你没有一个强悍的爹，就要先忘掉那些小鱼小蟹，还有珊瑚丛，那些暂时还不属于你，踏踏实实地练习和提升才是王道，为自己规划一个十年的长跑，可以时不时停下来休息一下，低下头汗水就落入尘埃，抬起头就看看夕阳西下，你抹去疲惫，然后继续前行。十年看似很长，但实在很短，十年以后你回头看看，你究竟是成了人中龙凤，还是小鱼小虾，是你认知了世界，还是世界抛弃了你。</p></blockquote>

<p>瞬间引起了共鸣。</p>

<p>闲话扯远了，作为一个国产OS的从业者，一直都从Android系统吸(chao)收(xi)营(yuan)养(ma)。其实我们更想借鉴ios系统，可惜人家不开源，光看表面是做不了神似的。在开发的过程中，也碰到不少问题，零零碎碎读过一些Android的源码，但基本上都是现学现用，缺乏整体的理解。既然做不了文艺青年，那我就来挑战一下Android系统源码吧。当然现在Android源码分析的书和文章也比较多，比如我手头就有邓凡平的《深入理解Android》、杨云君的《Android的设计与实现》和罗升阳的《Android系统源代码情景分析》，网上的文章更是不计其数。但别人分析了也是别人的，买了他们的书，但买不到他们的知识。还是需要亲自深入代码分析，知识才能变成我的。</p>

<p>在后续的学习中，我将结合自身的工作，分析我所感兴趣的部分。Android系统是一个相当庞大的系统，想要深入掌握每个细节，那是一个不可能完成的任务。所以我会略去驱动、linux内核、media等部分，初步计划阅读的部分如下：</p>

<ol>
<li>Android build系统</li>
<li>Android系统启动</li>
<li>Binder原理与实现</li>
<li>Surface系统</li>
<li>Dalvik虚拟机</li>
<li>chromium Webview</li>
</ol>


<p>为了让自己能坚持下去，要求在阅读过程中记笔记，每周至少写一篇博客，梳理一下阅读心得。希望我能够坚持下去并有所得，加油！</p>

<p><strong>[注]</strong> 本文引用的文字出自池建强《MacTalk人生元编程》P.194。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-11-13T20:36:35+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/xi-tong-fen-xi/'>系统分析</a>


</div>
	
	<div class="comments"><a href="/blog/2015/11/13/reading-android-source-preface/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/11/03/develop-android-browser-base-on-chromium-for-android/">
		
			基于chromium for android开发Android浏览器</a>
	</h2>
	<div class="entry-content">
		<p>在上一篇文章&lt;&lt; <a href="http://mogoweb.net/blog/2015/09/25/chromium-for-android-already-open-source/">Chromium for Android开源了</a> >>中谈到了Google已经完全开源了Chromium for Android，这样我们就完全可以开发与Chrome for Android媲美的Android浏览器了。通常浏览器的一些新特性和新功能会先出现在Chromium for Android上，稳定后才会出现在Chrome for Android上，如果我们基于Chromium for Android开发浏览器产品，在新特性和新功能方面不会落后于Chrome浏览器.</p>

<p>Chromium开源项目的代码及其庞大，也相当的复杂。对于Android开发人员，特别是UI开发人员来说，没有一个合适的IDE环境，会是一个非常痛苦的事情。我们通常是这样开发的，在sublime text中阅读、修改代码，使用chromium的构建系统build出apk，安装到手机，进行调试。对于native代码来说，这样的开发方式也不会有太多麻烦，因为native部分的代码通常修改很少。但如果主要进行UI的定制，这种开发方式就非常痛苦了。</p>

<p>为了应对这个问题，考虑如下方案：</p>

<ol>
<li>采用Android Studio作为开发环境，从Chromium for Android抽取chrome模块的源码，加入Android project。</li>
<li>native代码在chromium环境中build，作为so加入Android project</li>
<li>基础模块(base, content, net等)在chromium环境build为jar包，加入Android project</li>
<li>content, chrome, ui等模块的资源文件加入Android library project</li>
</ol>


<p>资源文件为什么不能直接都添加到Android project呢？因为命名空间的原因，比如content模块的资源的命名空间为org.chromium.content, chrome模块的资源的命名空间为org.chromium.chrome，所以需要建立不同的Android library project, 指定不同的包名。最后整个项目的结构如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>browser
</span><span class='line'>  |_ app
</span><span class='line'>  |    |_ libs
</span><span class='line'>  |    |_ src
</span><span class='line'>  |         |_ main
</span><span class='line'>  |              |_ aidl
</span><span class='line'>  |              |_ assets
</span><span class='line'>  |              |_ java
</span><span class='line'>  |              |_ jniLibs
</span><span class='line'>  |              |_ res
</span><span class='line'>  |_ libraries
</span><span class='line'>       |_ androidmedia_res
</span><span class='line'>       |_ chrome_res
</span><span class='line'>       |_ content_res
</span><span class='line'>       |_ datausagechart_res
</span><span class='line'>       |_ ui_res</span></code></pre></td></tr></table></div></figure>


<p>注意事项：</p>

<ol>
<li>chromium项目的源码和资源有些是自动生成的，需要到out目录下去复制</li>
<li>pak和dat等文件需要加入到assets目录，而且不能压缩</li>
<li>aidl文件加入到main/aidl下，android studio会自动处理</li>
</ol>


<p>实践证明，这种方案是行之有效的，请参考github上的项目: <a href="https://github.com/mogoweb/365browser">365browser</a>。在script目录下有从chromium项目同步代码和资源的脚本。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-11-03T08:39:21+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/chromium/'>chromium</a>


</div>
	
	<div class="comments"><a href="/blog/2015/11/03/develop-android-browser-base-on-chromium-for-android/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/09/25/chromium-for-android-already-open-source/">
		
			Chromium for Android开源了</a>
	</h2>
	<div class="entry-content">
		<p>最近一段时间都在忙其它的事情，没有关注chromium的最新进展。这几天浏览 <a href="http://www.chromium.org">http://www.chromium.org</a> 上的文档，发现android build目标增加了一个：chrome_public_apk。编译方法：</p>

<blockquote><h1>Build the full browser</h1>

<p>~/chromium/src$ ninja -C out/Release chrome_public_apk</p>

<p>~/chromium/src$ build/android/adb_install_apk.py out/Release/apks/ChromePublic.apk</p></blockquote>

<p>搜索了一下相关新闻，大约在2015年5月份开始，chromium中开始加入了chrome for android的源码。从2012年开始，chromium中开始出现Android的移植代码，但只有Content API和ContentShell，离一个完备的浏览器还有一定的距离。当然，基于Content API开发浏览器也是可行的，当年就是这么干的。Chromium for Android和Chrome for Android并非完全一样，就如同桌面版Chromium浏览器和Chrome浏览器之间的区别。</p>

<p>下面放上一些Chromium for Android浏览器的截图，慢慢品味吧：</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_welcome.png" alt="welcome" /></p>

<p>欢迎界面</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_account.png" alt="account" /></p>

<p>帐号同步界面</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_main.png" alt="main" /></p>

<p>浏览器主界面</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_menu.png" alt="menu" /></p>

<p>浏览器菜单</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_settings.png" alt="settings" /></p>

<p>浏览器设置</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2015_chromium_for_android_tabs.png" alt="tabs" /></p>

<p>浏览器标签页</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-09-25T09:08:49+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/chromium/'>chromium</a>


</div>
	
	<div class="comments"><a href="/blog/2015/09/25/chromium-for-android-already-open-source/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/09/10/customize-chrome-for-android/">
		
			打造自己的chrome for Android</a>
	</h2>
	<div class="entry-content">
		<p>[注] 这是两年前写的一篇旧文，现翻出来，根据现在的实际变化作了修订。</p>

<p>chromium移植已经接近尾声，正在冲刺beta版本。不过越往后面，越是一些难啃的骨头。虽然背靠chromium这座大山，但是网页的复杂性超乎想象。更郁闷的是，有些BUG在chrome for android上没有，但在我们的浏览器上存在。因此经常会有这样的质疑：人家的chrome浏览器好好的，你做的浏览器为什么会有这样的问题。面对这样的质疑，真是有苦说不出。在有些人看来，别人都把源代码开放出来了，超过他们是理所当然的。没有办法，碰到难啃的骨头只能迎难而上了。好在chrome for android（V25之后的版本）开始支持自行定制了，虽然没法调试全部的代码，但是部分代码还是可以调试的。这样在分析我们和chrome浏览器在代码执行路径上的差异，也许能够提供一种思路。下面就谈谈如何构建自己的chrome for android。</p>

<!--excerpt-->


<ol>
<li><p>使用您的android设备下载chrome for android，如果能够翻墙的话就在Google Play下载，国内的应用商店也一般有，这里就不详细说了。</p></li>
<li><p>打开您的android设备上的chrome for android，地址栏中输入chrome://version</p></li>
<li><p>记下Build ID(版本号ID)后的那一长串数字。</p></li>
<li><p>在PC机上访问 <a href="http://storage.googleapis.com/chrome-browser-components/">http://storage.googleapis.com/chrome-browser-components/</a>&lt;BUILD_ID>/index.html。其中&lt;BUILD_ID>为步骤3中的ID。下载该页面所列的文件。以下将以$CHROME_PREBUILT指代所存放的目录。</p></li>
<li><p>下载与chrome for android版本对应的chromium源码，请参考[<a href="http://dev.chromium.org/developers/how-tos/get-the-code#TOC-Check-out-the-source-for-a-branch-or-specific-release">http://dev.chromium.org/developers/how-tos/get-the-code#TOC-Check-out-the-source-for-a-branch-or-specific-release</a>]上的指导将代码切换到正确的release分支。下面就以$CHROMIUM_SRC指代chromium源码的src目录</p></li>
<li><p>build出自己的libchromeview.so库</p>

<ul>
<li>cd $CHROMIUM_SRC</li>
<li>mkdir chrome-android-prebuilts</li>
<li>cp $CHROME_PREBUILT/chromeview_target.gyp chrome-android-prebuilts/libchrome.gyp</li>
<li>mkdir -p out/Release</li>
<li>cp $CHROME_PREBUILT/libchrome_android_prebuilt.a out/Release</li>
<li>CHROMIUM_GYP_FILE=&ldquo;chrome-android-prebuilts/libchrome.gyp&rdquo; build/gyp_chromium</li>
<li>ninja -C  out/Release libchrome_prebuilt</li>
</ul>
</li>
<li><p>解包官方chrome的apk</p>

<ul>
<li> 使用USB连接设备</li>
<li> cd $CHROME_SRC</li>
<li> mkdir out/apk</li>
<li> cd out/apk</li>
<li> adb pull $(adb shell pm path $CHROME_PACKAGE | sed &#8216;s/package:([^\r ]+).*$/\1/g&#8217;)</li>
<li> 将pull出的apk重命名为Chrome.apk</li>
<li> apktool d Chrome.apk</li>
</ul>


<p> 注1：您也可以从网上下载Chrome for android，但要确保下载正确的版本</p>

<p> 注2：apktool 可以从<a href="http://code.google.com/p/android-apktool/">http://code.google.com/p/android-apktool/</a> 下载</p></li>
<li><p>更新应用程序包</p>

<ul>
<li> cp $CHROME_PREBUILT/change_chromium_package.py .</li>
<li> chmod a+x change_chromium_package.py</li>
<li> ./change_chromium_package.py -u Chrome -p desired_package_name -a desired_app_name</li>
<li> cp $CHROMIUM_SRC/out/Release/lib.target/libchromeview_prebuilt.so libchromeview.so</li>
<li> arm-linux-androideabi-strip libchromeview.so</li>
<li> cp libchromeview.so $CHROMIUM_SRC/out/apk/Chrome/lib/armeabi-v7a</li>
</ul>
</li>
<li><p>重新打包和安装apk</p>

<ul>
<li> apktool b Chrome Chromium_unaligned.apk</li>
<li> 签名apk，为了简便起见，可以使用debug key：</li>
</ul>


<blockquote><p>jarsigner -sigalg MD5withRSA -digestalg SHA1 -keystore PATH_TO_ANDROID_SDK/.android/debug.keystore -storepass android Chromium_unaligned.apk androiddebugkey</p></blockquote>

<ul>
<li> zipalign -f -v 4 Chromium_unaligned.apk Chromium.apk</li>
<li> adb install -r Chromium.apk</li>
</ul>
</li>
</ol>


<p>到此，自有品牌的chrome浏览器就此诞生，您可以更换logo，修复chromium的bug等等。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-09-10T22:01:54+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/chromium/'>chromium,</a>


</div>
	
	<div class="comments"><a href="/blog/2015/09/10/customize-chrome-for-android/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/06/30/how-to-print-variable-of-gyp/">
		
			如何打印gyp构建系统中的变量值</a>
	</h2>
	<div class="entry-content">
		<p>chromium项目使用了gyp构建系统，gyp的全称是&#8221;Generate Your Projects&#8221;。gyp构建系统使用的并不广泛，目前已知的只有chromium开源项目采用了这一构建系统。官方虽然也有一些文档，但都是一些比较基础的指南，总体来说缺少详细的文档来指导开发人员在项目中使用。
因为研究chromium的缘故，所以对gyp构建系统也有一些了解，在使用中也碰到一些问题，本文所要探讨的是如何输出gyp的变量值。这个问题的场景是这样的：在gyp中定义了变量，但是经过多重gypi包含，在别的gyp文件中可能对变量值进行了赋值。处于调试目的，我们希望输出gyp变量的值。</p>

<p>方法看起来很简单，但也摸索了很久。方法如下，在gyp中合适的位置加入如下代码：</p>

<pre><code>'variables': {
  'mytest': '&lt;!(echo &lt;(variable) 1&gt;&amp;2)',
}
</code></pre>

<p>其中&#8217;mytest&#8217;是我随便定义的一个变量值，variable是希望打印的gyp变量。比如以下语句：</p>

<pre><code>'variables': {
  'mytest': '&lt;!(echo &lt;(OS) 1&gt;&amp;2)',
}
</code></pre>

<p>输出如下结果：</p>

<pre><code>Updating projects from gyp files...
android
gyp: Call to 'echo android 1&gt;&amp;2' returned exit status 0.
</code></pre>

<p>从上面的输出可以看出，OS的变量值为android。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-30T14:16:51+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/chromium/'>chromium</a>


</div>
	
	<div class="comments"><a href="/blog/2015/06/30/how-to-print-variable-of-gyp/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/06/19/using-textureview-instead-of-surfaceview-in-chrome-for-android/">
		
			在Chromium for Android中能否用TextureView替代SurfaceView</a>
	</h2>
	<div class="entry-content">
		<p>在开发Browser 2.0时，碰到一个非常头疼的问题，往布局上添加SurfaceView时，会引起黑屏闪一下。为了解决这个问题，我们不得不在初始化阶段就把SurfaceView添加好，之后也不能调整大小、移动位置。当时就考虑是不是能够用TextureView替代SurfaceView，不过由于计划上的调整，没有做进一步的尝试。今天在网上看到<a href="https://github.com/crosswalk-project/crosswalk-website/wiki/Android-SurfaceView-vs-TextureView">这篇文章</a>，正好解答了我的疑问，在此把文章翻译过来，供参考。</p>

<blockquote><h1>Android SurfaceView和textureView</h1>

<p>本文将简要介绍SurfaceView和TextureView的不同之处</p>

<h2>SurfaceView和TextureView</h2>

<p>SurfaceView和TextureView都继承自android.view.View类，他们都可以在另一个独立线程中绘制和渲染，这是和其它View的最大不同。Crosswalk采用这一分离绘制特性，独立的GPU线程显著提高了渲染效率。</p>

<p>SurfaceView提供一个嵌入在视图层次上的专用绘制表面，您可以控制该表面（Surface）的格式和尺寸。SurfaceView负责将表面放置在屏幕上正确的位置。它的行为多少有些类似于传统桌面系统上的onscreen窗口，比如，X11系统中的XWindow可以是无边框的，嵌入在另一个XWindow中。</p>

<p>SurfaceView存在如下两个缺点：</p>

<ul>
<li>不能应用动画、变换和缩放</li>
<li>不能叠加（Overlay）两个SurfaceView</li>
</ul>


<p>TextureView看似更像一个通用的View，可以应用动画、变换和缩放，就如同TextView。TextureView只能用在硬件加速的窗口。但是，TextureView比SurfaceView更耗内存，而且可能会有1～3帧的延迟，请参考讨论<a href="https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4">3</a>。</p>

<h2>使用可以动画的XWalkView</h2>

<p>Crosswalk Embedding API for Android很好的支持了SurfaceView和TextureView。XWalkView缺省使用SurfaceView，也允许您在以下情况下使用TextureView：</p>

<ul>
<li>您想让XWalkView支持动画和变换</li>
<li>您想叠加两个XWalkView</li>
</ul>


<p>设置布尔标识ANIMATIBLE_XWALK_VIEW为true即可启用TextureView。</p>

<ol>
<li><a href="http://developer.android.com/reference/android/view/SurfaceView.html">http://developer.android.com/reference/android/view/SurfaceView.html</a></li>
<li><a href="http://developer.android.com/reference/android/view/TextureView.html">http://developer.android.com/reference/android/view/TextureView.html</a></li>
<li><a href="https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4">https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4</a></li>
</ol>
</blockquote>

<p>文中提到的讨论起源是在google groups中有人提出如下问题：</p>

<blockquote><p>在当前ContentViewRenderView实现中，使用SurfaceView作为合成表面(compositing surface)，如我们所知，SurfaceView是一个特别的视图，无法进行动画或者变换。</p>

<p>TextureView可以做SufaceView同样的事情，比如，您可以在另一个独立线程中渲染，也可以从底下的SurfaceTexture创建一个egl表面(eglSurface)。更主要的是，TextureView可以进行动画和变换。</p>

<p>我很好奇为什么不使用TextureView作为合成表面，是否TextureView在使用上有一些特别的考虑，比如性能问题？欢迎任何讨论。</p></blockquote>

<p>Google groups有人做如下回复：</p>

<blockquote><p>事实上chrome过去使用TextureView作为合成表面，但我们出于几个原因切换到SurfaceView：</p>

<ul>
<li>由于失效(invalidation)和缓冲的特性，TextureView增加了额外1~3帧的延迟显示画面更新</li>
<li>TextureView总是使用GL合成，而SurfaceTexture可以使用硬件overlay后端，可以占用更少的内存带宽，消耗更少的能量</li>
<li>TextureView的内部缓冲队列导致比SurfaceView使用更多的内存</li>
<li>TextureView的动画和变换能力我们用不上</li>
</ul>
</blockquote>

<p>所以结论是Chromium for Android中可以使用TextureView替代SurfaceView作为合成表面，但带来的后果是占用更多的内存，性能下降。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-06-19T19:26:45+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/chromium/'>chromium</a>


</div>
	
	<div class="comments"><a href="/blog/2015/06/19/using-textureview-instead-of-surfaceview-in-chrome-for-android/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/03/11/about-percent-u-paramters-in-ubuntu-menu-entry/">
		
			关于Ubuntu菜单项中的%U参数</a>
	</h2>
	<div class="entry-content">
		<p>今天在研究chromium deb打包的时候，发现Google Chrome deb包中的/usr/share/applications/google-chrome.desktop文件定义入口为：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Exec=/usr/bin/google-chrome-stable %U</span></code></pre></td></tr></table></div></figure>


<p>这个%U参数是做什么用的呢？查找了一下资料，有如下描述：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%u A single URL. Local files may either be passed as file: URLs or as file path.
</span><span class='line'>
</span><span class='line'>%U A list of URLs. Each URL is passed as a separate argument to the executable program. Local files may either be passed as file: URLs or as file path.</span></code></pre></td></tr></table></div></figure>


<p>也就是说，加入了%U参数，可以传递多个URL给Chrome浏览器，浏览器会依次打开各URL。比如您在文件管理器中选择了多个html文件，然后在鼠标右键菜单中点击&#8221;Open with Google Chrome&#8221;，Chrome浏览器就会依次打开所选的网页。</p>

<p>以下是Exec支持的参数说明，来自<a href="http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s06.html">http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s06.html</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Code Description
</span><span class='line'>%f    A single file name, even if multiple files are selected. The system reading the desktop entry should recognize that the program in question cannot handle multiple file arguments, and it should should probably spawn and execute multiple copies of a program for each selected file if the program is not able to handle additional file arguments. If files are not on the local file system (i.e. are on HTTP or FTP locations), the files will be copied to the local file system and %f will be expanded to point at the temporary file. Used for programs that do not understand the URL syntax.
</span><span class='line'>%F    A list of files. Use for apps that can open several local files at once. Each file is passed as a separate argument to the executable program.
</span><span class='line'>%u    A single URL. Local files may either be passed as file: URLs or as file path.
</span><span class='line'>%U    A list of URLs. Each URL is passed as a separate argument to the executable program. Local files may either be passed as file: URLs or as file path.
</span><span class='line'>%d    Deprecated.
</span><span class='line'>%D    Deprecated.
</span><span class='line'>%n    Deprecated.
</span><span class='line'>%N    Deprecated.
</span><span class='line'>%i    The Icon key of the desktop entry expanded as two arguments, first --icon and then the value of the Icon key. Should not expand to any arguments if the Icon key is empty or missing.
</span><span class='line'>%c    The translated name of the application as listed in the appropriate Name key in the desktop entry.
</span><span class='line'>%k    The location of the desktop file as either a URI (if for example gotten from the vfolder system) or a local filename or empty if no location is known.
</span><span class='line'>%v    Deprecated.
</span><span class='line'>%m    Deprecated.</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-03-11T16:05:57+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/chromium/'>chromium</a>, <a class='category' href='/blog/categories/ubuntu/'>ubuntu</a>


</div>
	
	<div class="comments"><a href="/blog/2015/03/11/about-percent-u-paramters-in-ubuntu-menu-entry/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/03/11/solve-the-virtualbox-starting-problem/">
		
			Ubuntu 14.04 VirtualBox启动问题之解决</a>
	</h2>
	<div class="entry-content">
		<p>开发机上的Ubuntu从12.10升级到14.04后，发现VirtualBox无法启动，有如下提示</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Setting up virtualbox (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'> * Stopping VirtualBox kernel modules                   [ OK ] 
</span><span class='line'> * Starting VirtualBox kernel modules
</span><span class='line'>     * No suitable module for running kernel found
</span><span class='line'>                                                        [fail]
</span><span class='line'>invoke-rc.d: initscript virtualbox, action "restart" failed.</span></code></pre></td></tr></table></div></figure>


<p>解决方法如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get purge virtualbox
</span><span class='line'>sudo apt-get install linux-generic linux-image-generic linux-headers-generic linux-signed-generic
</span><span class='line'>sudo apt-get install virtualbox</span></code></pre></td></tr></table></div></figure>


<p>安装irtualbox的信息如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Reading package lists... Done
</span><span class='line'>Building dependency tree       
</span><span class='line'>Reading state information... Done
</span><span class='line'>The following extra packages will be installed:
</span><span class='line'>  virtualbox-dkms virtualbox-qt
</span><span class='line'>Suggested packages:
</span><span class='line'>  virtualbox-guest-additions-iso vde2
</span><span class='line'>The following NEW packages will be installed:
</span><span class='line'>  virtualbox virtualbox-dkms virtualbox-qt
</span><span class='line'>0 upgraded, 3 newly installed, 0 to remove and 29 not upgraded.
</span><span class='line'>Need to get 0 B/20.5 MB of archives.
</span><span class='line'>After this operation, 84.1 MB of additional disk space will be used.
</span><span class='line'>Do you want to continue? [Y/n] y
</span><span class='line'>WARNING: The following packages cannot be authenticated!
</span><span class='line'>  virtualbox virtualbox-dkms virtualbox-qt
</span><span class='line'>Install these packages without verification? [y/N] y
</span><span class='line'>Selecting previously unselected package virtualbox.
</span><span class='line'>(Reading database ... 276049 files and directories currently installed.)
</span><span class='line'>Preparing to unpack .../virtualbox_4.3.10-dfsg-1ubuntu3_amd64.deb ...
</span><span class='line'>Unpacking virtualbox (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Selecting previously unselected package virtualbox-dkms.
</span><span class='line'>Preparing to unpack .../virtualbox-dkms_4.3.10-dfsg-1ubuntu3_all.deb ...
</span><span class='line'>Unpacking virtualbox-dkms (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Selecting previously unselected package virtualbox-qt.
</span><span class='line'>Preparing to unpack .../virtualbox-qt_4.3.10-dfsg-1ubuntu3_amd64.deb ...
</span><span class='line'>Unpacking virtualbox-qt (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Processing triggers for man-db (2.6.7.1-1ubuntu1) ...
</span><span class='line'>Processing triggers for ureadahead (0.100.0-16) ...
</span><span class='line'>Processing triggers for hicolor-icon-theme (0.13-1) ...
</span><span class='line'>Processing triggers for shared-mime-info (1.2-0ubuntu3) ...
</span><span class='line'>Processing triggers for bamfdaemon (0.5.1+14.04.20140409-0ubuntu1) ...
</span><span class='line'>Rebuilding /usr/share/applications/bamf-2.index...
</span><span class='line'>Processing triggers for desktop-file-utils (0.22-1ubuntu1) ...
</span><span class='line'>Processing triggers for mime-support (3.54ubuntu1.1) ...
</span><span class='line'>Processing triggers for gnome-menus (3.10.1-0ubuntu2) ...
</span><span class='line'>Setting up virtualbox (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'> * Stopping VirtualBox kernel modules                                                                                                                                                                 [ OK ] 
</span><span class='line'> * Starting VirtualBox kernel modules                                                                                                                                                                         * No suitable module for running kernel found
</span><span class='line'>                                                                                                                                                                                                      [fail]
</span><span class='line'>invoke-rc.d: initscript virtualbox, action "restart" failed.
</span><span class='line'>Processing triggers for ureadahead (0.100.0-16) ...
</span><span class='line'>Setting up virtualbox-dkms (4.3.10-dfsg-1ubuntu3) ...
</span><span class='line'>Loading new virtualbox-4.3.10 DKMS files...
</span><span class='line'>First Installation: checking all kernels...
</span><span class='line'>Building only for 3.13.0-46-generic
</span><span class='line'>Building initial module for 3.13.0-46-generic
</span><span class='line'>Done.
</span><span class='line'>
</span><span class='line'>vboxdrv:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>vboxnetadp.ko:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>vboxnetflt.ko:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>vboxpci.ko:
</span><span class='line'>Running module version sanity check.
</span><span class='line'> - Original module
</span><span class='line'>   - No original module exists within this kernel
</span><span class='line'> - Installation
</span><span class='line'>   - Installing to /lib/modules/3.13.0-46-generic/updates/dkms/
</span><span class='line'>
</span><span class='line'>depmod....
</span><span class='line'>
</span><span class='line'>DKMS: install completed.
</span><span class='line'> * Stopping VirtualBox kernel modules         [ OK ]
</span><span class='line'> * Starting VirtualBox kernel modules         [ OK ]
</span><span class='line'>Setting up virtualbox-qt (4.3.10-dfsg-1ubuntu3) ...</span></code></pre></td></tr></table></div></figure>


<p>这个时候virtualbox可以启动了。但是建立了虚拟机后，启动虚拟系统时提示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VT-x is disabled in the BIOS </span></code></pre></td></tr></table></div></figure>


<p>解决方法:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>重启系统
</span><span class='line'>长按 DEL 进入 BIOS
</span><span class='line'>方向键切到 BIOS Features
</span><span class='line'>选中如下选项
</span><span class='line'>Intel Virtualization Technology
</span><span class='line'>
</span><span class='line'>选择 Enable
</span><span class='line'>按下 F10 保存并重启</span></code></pre></td></tr></table></div></figure>


<p>因为各个机器的bios设置并不相同，请根据自己电脑的设置查找“Intel Virtualization Technology”, 大部分电脑默认是Disable的。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-03-11T08:54:49+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/ubuntu/'>ubuntu</a>


</div>
	
	<div class="comments"><a href="/blog/2015/03/11/solve-the-virtualbox-starting-problem/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/12/15/build-chromium-browser-from-source/">
		
			Ubuntu上从源码编译chromium浏览器</a>
	</h2>
	<div class="entry-content">
		<p>Ubuntu不仅是一个免费且开源的操作系统，而且其平台也是开放且透明的。每个组件的源码都可以获取到，也可以从源码自己编译软件包。下面就探讨一下在ubuntu下如何获取chromium源码，并编译Chromium Web Browser。</p>

<p>要从ubuntu的仓库下载源码并编译软件包，最方便的就是使用apt-build实用工具。在ubuntu的发布版本中，该实用工具并没有安装，您可以用如下命令安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install apt-build</span></code></pre></td></tr></table></div></figure>


<p>接下来就可以使用如下命令下载并build chromium browser了:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-build install chromium-browser</span></code></pre></td></tr></table></div></figure>


<p>因为我的ubuntu是64位系统(ubuntu 11.04 LTS 64bit)，所以出现了如下错误:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>E: There are problems and -y was used without --force-yes
</span><span class='line'>E: Failed to process build dependencies
</span><span class='line'>-----&gt; Updating package lists &lt;-----
</span><span class='line'>Ign file: apt-build Release.gpg
</span><span class='line'>Get:1 file: apt-build Release [107 B]                                                                                                                
</span><span class='line'>Ign file: apt-build/main TranslationIndex                                                                                                            
</span><span class='line'>Err file: apt-build/main i386 Packages                                                                                                               
</span><span class='line'>  File not found
</span><span class='line'>Ign file: apt-build/main Translation-en_US                                                                                                           
</span><span class='line'>Ign file: apt-build/main Translation-en                                                                                                              
</span><span class='line'>Get:2 http://mirrors.163.com precise-updates Release.gpg [198 B]                                                                                     
</span><span class='line'>Get:3 http://mirrors.163.com precise Release.gpg [198 B]                                                                                             
</span><span class='line'>Hit http://mirrors.163.com precise-updates Release                                                                                                   
</span><span class='line'>Hit http://mirrors.163.com precise Release                                                                                                           
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted Sources                                                                                        
</span><span class='line'>Get:4 http://dl.google.com stable Release.gpg [198 B]                                                                                                
</span><span class='line'>Get:5 http://archive.ubuntu.com precise Release.gpg [198 B]                                                                                          
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main Sources                                                                                              
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe Sources                                                                                          
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main amd64 Packages                                                                                       
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted amd64 Packages                                                                                 
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe amd64 Packages                                                                                   
</span><span class='line'>Get:6 http://ppa.launchpad.net precise Release.gpg [316 B]                                                                                           
</span><span class='line'>Get:7 http://extras.ubuntu.com precise Release.gpg [72 B]                                                                                            
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main i386 Packages                                                                                        
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted i386 Packages                                                                                  
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe i386 Packages                                                                                    
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main TranslationIndex                                                                                     
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted TranslationIndex                                                                               
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe TranslationIndex                                                                                 
</span><span class='line'>Hit http://mirrors.163.com precise/universe amd64 Packages                                                                                           
</span><span class='line'>Hit http://mirrors.163.com precise/universe i386 Packages                                                                                            
</span><span class='line'>Hit http://dl.google.com stable Release                                                                                                              
</span><span class='line'>Hit http://mirrors.163.com precise/universe TranslationIndex                                                                                         
</span><span class='line'>Hit http://mirrors.163.com precise-updates/main Translation-en                                                                                       
</span><span class='line'>Hit http://mirrors.163.com precise-updates/restricted Translation-en                                                                                 
</span><span class='line'>Hit http://mirrors.163.com precise-updates/universe Translation-en                                                                                   
</span><span class='line'>Hit http://mirrors.163.com precise/universe Translation-en                                                                                           
</span><span class='line'>Hit http://dl.google.com stable/main amd64 Packages                                                                                                  
</span><span class='line'>Hit http://archive.ubuntu.com precise Release                                                                                                        
</span><span class='line'>Hit http://dl.google.com stable/main i386 Packages                                                                                                   
</span><span class='line'>Hit http://ppa.launchpad.net precise Release                                                                                                         
</span><span class='line'>Ign http://dl.google.com stable/main TranslationIndex                                                                                                
</span><span class='line'>Hit http://extras.ubuntu.com precise Release                                                                                                         
</span><span class='line'>Get:8 http://security.ubuntu.com precise-security Release.gpg [198 B]                                                                                
</span><span class='line'>Hit http://archive.ubuntu.com precise/main Sources                                                                                                   
</span><span class='line'>Get:9 http://cn.archive.ubuntu.com precise Release.gpg [198 B]                                                                                       
</span><span class='line'>Hit http://ppa.launchpad.net precise/main Sources                                                                                                    
</span><span class='line'>Hit http://extras.ubuntu.com precise/main Sources                                                                                                    
</span><span class='line'>Hit http://security.ubuntu.com precise-security Release                                                                                              
</span><span class='line'>Hit http://archive.ubuntu.com precise/restricted Sources                                                                                             
</span><span class='line'>Hit http://ppa.launchpad.net precise/main amd64 Packages                                                                                    
</span><span class='line'>Hit http://ppa.launchpad.net precise/main i386 Packages                                                                              
</span><span class='line'>Ign http://ppa.launchpad.net precise/main TranslationIndex                                                                           
</span><span class='line'>Hit http://extras.ubuntu.com precise/main amd64 Packages                                                                             
</span><span class='line'>Hit http://extras.ubuntu.com precise/main i386 Packages                                                                              
</span><span class='line'>Ign http://extras.ubuntu.com precise/main TranslationIndex                                                                           
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted Sources                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main Sources                                                      
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe Sources                                                                   
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise Release                                                                                   
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main amd64 Packages                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted amd64 Packages                                                                            
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe amd64 Packages                                                                              
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main i386 Packages                                                                                   
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted i386 Packages                                                                             
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe i386 Packages                                                                               
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main TranslationIndex                                                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted TranslationIndex                                                                          
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe TranslationIndex                                                                            
</span><span class='line'>Ign http://dl.google.com stable/main Translation-en_US                                                                                               
</span><span class='line'>Hit http://security.ubuntu.com precise-security/main Translation-en                                                                                  
</span><span class='line'>Ign http://dl.google.com stable/main Translation-en                                                                                                  
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main Sources                                                                                                
</span><span class='line'>Hit http://security.ubuntu.com precise-security/restricted Translation-en                                                                            
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted Sources                                                                                          
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main amd64 Packages                                                                                         
</span><span class='line'>Hit http://security.ubuntu.com precise-security/universe Translation-en                                                                              
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted amd64 Packages                                                                                   
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main i386 Packages                                                                                          
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted i386 Packages                                                                                    
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main TranslationIndex                                                                                       
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted TranslationIndex                                                                                 
</span><span class='line'>Ign http://ppa.launchpad.net precise/main Translation-en_US                                                                                          
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/main Translation-en                                                                                         
</span><span class='line'>Ign http://extras.ubuntu.com precise/main Translation-en_US                                                                                          
</span><span class='line'>Ign http://extras.ubuntu.com precise/main Translation-en                                                                                             
</span><span class='line'>Hit http://cn.archive.ubuntu.com precise/restricted Translation-en                                                                                   
</span><span class='line'>Ign http://ppa.launchpad.net precise/main Translation-en                                                                                             
</span><span class='line'>Fetched 1,576 B in 10s (147 B/s)                                                                                                                     
</span><span class='line'>W: Failed to fetch file:/var/cache/apt-build/repository/dists/apt-build/main/binary-i386/Packages  File not found</span></code></pre></td></tr></table></div></figure>


<p>从网上找到了答案，解决方法就是指定配置文件中的架构：修改<em>/etc/apt/sources.list.d/apt-build.list</em>文件，将其中的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>deb file:/var/cache/apt-build/repository apt-build main</span></code></pre></td></tr></table></div></figure>


<p>替换为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>deb [arch=amd64] file:/var/cache/apt-build/repository apt-build main</span></code></pre></td></tr></table></div></figure>


<p>接下来就是下载源码，再经过漫长的build过程，生成并安装Chromium Web Browser。版本信息如下图:</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2014_chromium_for_linux_37.0.2062.120_info.png" alt="chrome://version" /></p>

<p>下载的源码位于<em>/var/cache/apt-build/build/</em>下：</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2014_chromium_ubuntu_source_info.png" alt="" /></p>

<p>从上图中可以看到源码包的大小只有200多M，而我们从chromium开源项目下的源码通常有7、8个G，主要原因是这里下的源码是不带git和svn信息的，是纯粹的源代码。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-12-15T15:09:43+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/chromium/'>chromium</a>, <a class='category' href='/blog/categories/ubuntu/'>ubuntu</a>


</div>
	
	<div class="comments"><a href="/blog/2014/12/15/build-chromium-browser-from-source/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/12/09/mirror-chromium-to-local-server/">
		
			在本地服务器上建立chromium镜像</a>
	</h2>
	<div class="entry-content">
		<p>Android 5.0发布了好长时间，一直都没有来得及研究。前两周终于将android 5.0源码下载了下来，大致看了一下代码。我所关注的并非Material Design，而是Android 5.0的web引擎。从Android 4.4开始，采用了chromium/blink内核，Android 5.0自然也不例外，只是chromium的版本升级到了37.0.2062.116。想到我的chromium webview项目，仍然采用的是34.0.1847，因此打算也将chromium版本进行一次升级。</p>

<p>因为可恶的GFW，下载代码及其不顺利，虽然有VPN，但是对于几十G的chromium下载量，下载速度太慢，而且git不支持断点续传。在折腾了两三个星期之后，决定在公司的服务器上建立chromium的镜像。不知道从哪个版本开始，gclient开始全面转向git。由于git的天然的分布式特点，这为完全镜像chromium源码库提供了便利。</p>

<p>chromium源码库是由chromium本身加上一堆第三方开源库组成，极其庞大。为此我写了一个脚本，放到了github上，有兴趣的可以访问<a href="https://github.com/mogoweb/chromium_mirror_script">chromium_mirror_script</a>项目，其中chromium_git_list.txt为所有的源码库列表，来自<a href="https://chromium.googlesource.com/">https://chromium.googlesource.com/</a>，随着时间的推移，这个列表也可能发生变化。</p>

<p>有了内部的chromium镜像后，我们可以修改.DEPS.git文件，将其中的git_url值替换为本地git地址，这样通过gclient下载，就是从本地镜像服务器上获取代码了。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-12-09T21:59:27+08:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/chromium/'>chromium</a>


</div>
	
	<div class="comments"><a href="/blog/2014/12/09/mirror-chromium-to-local-server/#disqus_thread">Comments</a></div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/posts/2" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    mogoweb

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'mogoweb';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>