<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: chromium | 放飞梦想]]></title>
  <link href="http://mogoweb.net/blog/categories/chromium/atom.xml" rel="self"/>
  <link href="http://mogoweb.net/"/>
  <updated>2015-09-24T16:29:10+08:00</updated>
  <id>http://mogoweb.net/</id>
  <author>
    <name><![CDATA[mogoweb]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[如何打印gyp构建系统中的变量值]]></title>
    <link href="http://mogoweb.net/blog/2015/06/30/how-to-print-variable-of-gyp/"/>
    <updated>2015-06-30T14:16:51+08:00</updated>
    <id>http://mogoweb.net/blog/2015/06/30/how-to-print-variable-of-gyp</id>
    <content type="html"><![CDATA[<p>chromium项目使用了gyp构建系统，gyp的全称是&#8221;Generate Your Projects&#8221;。gyp构建系统使用的并不广泛，目前已知的只有chromium开源项目采用了这一构建系统。官方虽然也有一些文档，但都是一些比较基础的指南，总体来说缺少详细的文档来指导开发人员在项目中使用。
因为研究chromium的缘故，所以对gyp构建系统也有一些了解，在使用中也碰到一些问题，本文所要探讨的是如何输出gyp的变量值。这个问题的场景是这样的：在gyp中定义了变量，但是经过多重gypi包含，在别的gyp文件中可能对变量值进行了赋值。处于调试目的，我们希望输出gyp变量的值。</p>

<p>方法看起来很简单，但也摸索了很久。方法如下，在gyp中合适的位置加入如下代码：</p>

<pre><code>'variables': {
  'mytest': '&lt;!(echo &lt;(variable) 1&gt;&amp;2)',
}
</code></pre>

<p>其中&#8217;mytest&#8217;是我随便定义的一个变量值，variable是希望打印的gyp变量。比如以下语句：</p>

<pre><code>'variables': {
  'mytest': '&lt;!(echo &lt;(OS) 1&gt;&amp;2)',
}
</code></pre>

<p>输出如下结果：</p>

<pre><code>Updating projects from gyp files...
android
gyp: Call to 'echo android 1&gt;&amp;2' returned exit status 0.
</code></pre>

<p>从上面的输出可以看出，OS的变量值为android。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在Chromium for Android中能否用TextureView替代SurfaceView]]></title>
    <link href="http://mogoweb.net/blog/2015/06/19/using-textureview-instead-of-surfaceview-in-chrome-for-android/"/>
    <updated>2015-06-19T19:26:45+08:00</updated>
    <id>http://mogoweb.net/blog/2015/06/19/using-textureview-instead-of-surfaceview-in-chrome-for-android</id>
    <content type="html"><![CDATA[<p>在开发Browser 2.0时，碰到一个非常头疼的问题，往布局上添加SurfaceView时，会引起黑屏闪一下。为了解决这个问题，我们不得不在初始化阶段就把SurfaceView添加好，之后也不能调整大小、移动位置。当时就考虑是不是能够用TextureView替代SurfaceView，不过由于计划上的调整，没有做进一步的尝试。今天在网上看到<a href="https://github.com/crosswalk-project/crosswalk-website/wiki/Android-SurfaceView-vs-TextureView">这篇文章</a>，正好解答了我的疑问，在此把文章翻译过来，供参考。</p>

<blockquote><h1>Android SurfaceView和textureView</h1>

<p>本文将简要介绍SurfaceView和TextureView的不同之处</p>

<h2>SurfaceView和TextureView</h2>

<p>SurfaceView和TextureView都继承自android.view.View类，他们都可以在另一个独立线程中绘制和渲染，这是和其它View的最大不同。Crosswalk采用这一分离绘制特性，独立的GPU线程显著提高了渲染效率。</p>

<p>SurfaceView提供一个嵌入在视图层次上的专用绘制表面，您可以控制该表面（Surface）的格式和尺寸。SurfaceView负责将表面放置在屏幕上正确的位置。它的行为多少有些类似于传统桌面系统上的onscreen窗口，比如，X11系统中的XWindow可以是无边框的，嵌入在另一个XWindow中。</p>

<p>SurfaceView存在如下两个缺点：</p>

<ul>
<li>不能应用动画、变换和缩放</li>
<li>不能叠加（Overlay）两个SurfaceView</li>
</ul>


<p>TextureView看似更像一个通用的View，可以应用动画、变换和缩放，就如同TextView。TextureView只能用在硬件加速的窗口。但是，TextureView比SurfaceView更耗内存，而且可能会有1～3帧的延迟，请参考讨论<a href="https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4">3</a>。</p>

<h2>使用可以动画的XWalkView</h2>

<p>Crosswalk Embedding API for Android很好的支持了SurfaceView和TextureView。XWalkView缺省使用SurfaceView，也允许您在以下情况下使用TextureView：</p>

<ul>
<li>您想让XWalkView支持动画和变换</li>
<li>您想叠加两个XWalkView</li>
</ul>


<p>设置布尔标识ANIMATIBLE_XWALK_VIEW为true即可启用TextureView。</p>

<ol>
<li><a href="http://developer.android.com/reference/android/view/SurfaceView.html">http://developer.android.com/reference/android/view/SurfaceView.html</a></li>
<li><a href="http://developer.android.com/reference/android/view/TextureView.html">http://developer.android.com/reference/android/view/TextureView.html</a></li>
<li><a href="https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4">https://groups.google.com/a/chromium.org/forum/#!topic/graphics-dev/Z0yE-PWQXc4</a></li>
</ol>
</blockquote>

<p>文中提到的讨论起源是在google groups中有人提出如下问题：</p>

<blockquote><p>在当前ContentViewRenderView实现中，使用SurfaceView作为合成表面(compositing surface)，如我们所知，SurfaceView是一个特别的视图，无法进行动画或者变换。</p>

<p>TextureView可以做SufaceView同样的事情，比如，您可以在另一个独立线程中渲染，也可以从底下的SurfaceTexture创建一个egl表面(eglSurface)。更主要的是，TextureView可以进行动画和变换。</p>

<p>我很好奇为什么不使用TextureView作为合成表面，是否TextureView在使用上有一些特别的考虑，比如性能问题？欢迎任何讨论。</p></blockquote>

<p>Google groups有人做如下回复：</p>

<blockquote><p>事实上chrome过去使用TextureView作为合成表面，但我们出于几个原因切换到SurfaceView：</p>

<ul>
<li>由于失效(invalidation)和缓冲的特性，TextureView增加了额外1~3帧的延迟显示画面更新</li>
<li>TextureView总是使用GL合成，而SurfaceTexture可以使用硬件overlay后端，可以占用更少的内存带宽，消耗更少的能量</li>
<li>TextureView的内部缓冲队列导致比SurfaceView使用更多的内存</li>
<li>TextureView的动画和变换能力我们用不上</li>
</ul>
</blockquote>

<p>所以结论是Chromium for Android中可以使用TextureView替代SurfaceView作为合成表面，但带来的后果是占用更多的内存，性能下降。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于Ubuntu菜单项中的%U参数]]></title>
    <link href="http://mogoweb.net/blog/2015/03/11/about-percent-u-paramters-in-ubuntu-menu-entry/"/>
    <updated>2015-03-11T16:05:57+08:00</updated>
    <id>http://mogoweb.net/blog/2015/03/11/about-percent-u-paramters-in-ubuntu-menu-entry</id>
    <content type="html"><![CDATA[<p>今天在研究chromium deb打包的时候，发现Google Chrome deb包中的/usr/share/applications/google-chrome.desktop文件定义入口为：
<code>
Exec=/usr/bin/google-chrome-stable %U
</code>
这个%U参数是做什么用的呢？查找了一下资料，有如下描述：
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%u A single URL. Local files may either be passed as file: URLs or as file path.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;%U A list of URLs. Each URL is passed as a separate argument to the executable program. Local files may either be passed as file: URLs or as file path.</span></code></pre></td></tr></table></div></figure>
也就是说，加入了%U参数，可以传递多个URL给Chrome浏览器，浏览器会依次打开各URL。比如您在文件管理器中选择了多个html文件，然后在鼠标右键菜单中点击&#8221;Open with Google Chrome&#8221;，Chrome浏览器就会依次打开所选的网页。</p>

<p>以下是Exec支持的参数说明，来自<a href="http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s06.html">http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s06.html</a>:
<code>
Code    Description
%f  A single file name, even if multiple files are selected. The system reading the desktop entry should recognize that the program in question cannot handle multiple file arguments, and it should should probably spawn and execute multiple copies of a program for each selected file if the program is not able to handle additional file arguments. If files are not on the local file system (i.e. are on HTTP or FTP locations), the files will be copied to the local file system and %f will be expanded to point at the temporary file. Used for programs that do not understand the URL syntax.
%F  A list of files. Use for apps that can open several local files at once. Each file is passed as a separate argument to the executable program.
%u  A single URL. Local files may either be passed as file: URLs or as file path.
%U  A list of URLs. Each URL is passed as a separate argument to the executable program. Local files may either be passed as file: URLs or as file path.
%d  Deprecated.
%D  Deprecated.
%n  Deprecated.
%N  Deprecated.
%i  The Icon key of the desktop entry expanded as two arguments, first --icon and then the value of the Icon key. Should not expand to any arguments if the Icon key is empty or missing.
%c  The translated name of the application as listed in the appropriate Name key in the desktop entry.
%k  The location of the desktop file as either a URI (if for example gotten from the vfolder system) or a local filename or empty if no location is known.
%v  Deprecated.
%m  Deprecated.
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu上从源码编译chromium浏览器]]></title>
    <link href="http://mogoweb.net/blog/2014/12/15/build-chromium-browser-from-source/"/>
    <updated>2014-12-15T15:09:43+08:00</updated>
    <id>http://mogoweb.net/blog/2014/12/15/build-chromium-browser-from-source</id>
    <content type="html"><![CDATA[<p>Ubuntu不仅是一个免费且开源的操作系统，而且其平台也是开放且透明的。每个组件的源码都可以获取到，也可以从源码自己编译软件包。下面就探讨一下在ubuntu下如何获取chromium源码，并编译Chromium Web Browser。</p>

<p>要从ubuntu的仓库下载源码并编译软件包，最方便的就是使用apt-build实用工具。在ubuntu的发布版本中，该实用工具并没有安装，您可以用如下命令安装:</p>

<pre><code>sudo apt-get install apt-build
</code></pre>

<p>接下来就可以使用如下命令下载并build chromium browser了:</p>

<pre><code>sudo apt-build install chromium-browser
</code></pre>

<p>因为我的ubuntu是64位系统(ubuntu 11.04 LTS 64bit)，所以出现了如下错误:</p>

<pre><code>E: There are problems and -y was used without --force-yes
E: Failed to process build dependencies
-----&gt; Updating package lists &lt;-----
Ign file: apt-build Release.gpg
Get:1 file: apt-build Release [107 B]                                                                                                                
Ign file: apt-build/main TranslationIndex                                                                                                            
Err file: apt-build/main i386 Packages                                                                                                               
  File not found
Ign file: apt-build/main Translation-en_US                                                                                                           
Ign file: apt-build/main Translation-en                                                                                                              
Get:2 http://mirrors.163.com precise-updates Release.gpg [198 B]                                                                                     
Get:3 http://mirrors.163.com precise Release.gpg [198 B]                                                                                             
Hit http://mirrors.163.com precise-updates Release                                                                                                   
Hit http://mirrors.163.com precise Release                                                                                                           
Hit http://mirrors.163.com precise-updates/restricted Sources                                                                                        
Get:4 http://dl.google.com stable Release.gpg [198 B]                                                                                                
Get:5 http://archive.ubuntu.com precise Release.gpg [198 B]                                                                                          
Hit http://mirrors.163.com precise-updates/main Sources                                                                                              
Hit http://mirrors.163.com precise-updates/universe Sources                                                                                          
Hit http://mirrors.163.com precise-updates/main amd64 Packages                                                                                       
Hit http://mirrors.163.com precise-updates/restricted amd64 Packages                                                                                 
Hit http://mirrors.163.com precise-updates/universe amd64 Packages                                                                                   
Get:6 http://ppa.launchpad.net precise Release.gpg [316 B]                                                                                           
Get:7 http://extras.ubuntu.com precise Release.gpg [72 B]                                                                                            
Hit http://mirrors.163.com precise-updates/main i386 Packages                                                                                        
Hit http://mirrors.163.com precise-updates/restricted i386 Packages                                                                                  
Hit http://mirrors.163.com precise-updates/universe i386 Packages                                                                                    
Hit http://mirrors.163.com precise-updates/main TranslationIndex                                                                                     
Hit http://mirrors.163.com precise-updates/restricted TranslationIndex                                                                               
Hit http://mirrors.163.com precise-updates/universe TranslationIndex                                                                                 
Hit http://mirrors.163.com precise/universe amd64 Packages                                                                                           
Hit http://mirrors.163.com precise/universe i386 Packages                                                                                            
Hit http://dl.google.com stable Release                                                                                                              
Hit http://mirrors.163.com precise/universe TranslationIndex                                                                                         
Hit http://mirrors.163.com precise-updates/main Translation-en                                                                                       
Hit http://mirrors.163.com precise-updates/restricted Translation-en                                                                                 
Hit http://mirrors.163.com precise-updates/universe Translation-en                                                                                   
Hit http://mirrors.163.com precise/universe Translation-en                                                                                           
Hit http://dl.google.com stable/main amd64 Packages                                                                                                  
Hit http://archive.ubuntu.com precise Release                                                                                                        
Hit http://dl.google.com stable/main i386 Packages                                                                                                   
Hit http://ppa.launchpad.net precise Release                                                                                                         
Ign http://dl.google.com stable/main TranslationIndex                                                                                                
Hit http://extras.ubuntu.com precise Release                                                                                                         
Get:8 http://security.ubuntu.com precise-security Release.gpg [198 B]                                                                                
Hit http://archive.ubuntu.com precise/main Sources                                                                                                   
Get:9 http://cn.archive.ubuntu.com precise Release.gpg [198 B]                                                                                       
Hit http://ppa.launchpad.net precise/main Sources                                                                                                    
Hit http://extras.ubuntu.com precise/main Sources                                                                                                    
Hit http://security.ubuntu.com precise-security Release                                                                                              
Hit http://archive.ubuntu.com precise/restricted Sources                                                                                             
Hit http://ppa.launchpad.net precise/main amd64 Packages                                                                                    
Hit http://ppa.launchpad.net precise/main i386 Packages                                                                              
Ign http://ppa.launchpad.net precise/main TranslationIndex                                                                           
Hit http://extras.ubuntu.com precise/main amd64 Packages                                                                             
Hit http://extras.ubuntu.com precise/main i386 Packages                                                                              
Ign http://extras.ubuntu.com precise/main TranslationIndex                                                                           
Hit http://security.ubuntu.com precise-security/restricted Sources                                                
Hit http://security.ubuntu.com precise-security/main Sources                                                      
Hit http://security.ubuntu.com precise-security/universe Sources                                                                   
Hit http://cn.archive.ubuntu.com precise Release                                                                                   
Hit http://security.ubuntu.com precise-security/main amd64 Packages                                                
Hit http://security.ubuntu.com precise-security/restricted amd64 Packages                                                                            
Hit http://security.ubuntu.com precise-security/universe amd64 Packages                                                                              
Hit http://security.ubuntu.com precise-security/main i386 Packages                                                                                   
Hit http://security.ubuntu.com precise-security/restricted i386 Packages                                                                             
Hit http://security.ubuntu.com precise-security/universe i386 Packages                                                                               
Hit http://security.ubuntu.com precise-security/main TranslationIndex                                                                                
Hit http://security.ubuntu.com precise-security/restricted TranslationIndex                                                                          
Hit http://security.ubuntu.com precise-security/universe TranslationIndex                                                                            
Ign http://dl.google.com stable/main Translation-en_US                                                                                               
Hit http://security.ubuntu.com precise-security/main Translation-en                                                                                  
Ign http://dl.google.com stable/main Translation-en                                                                                                  
Hit http://cn.archive.ubuntu.com precise/main Sources                                                                                                
Hit http://security.ubuntu.com precise-security/restricted Translation-en                                                                            
Hit http://cn.archive.ubuntu.com precise/restricted Sources                                                                                          
Hit http://cn.archive.ubuntu.com precise/main amd64 Packages                                                                                         
Hit http://security.ubuntu.com precise-security/universe Translation-en                                                                              
Hit http://cn.archive.ubuntu.com precise/restricted amd64 Packages                                                                                   
Hit http://cn.archive.ubuntu.com precise/main i386 Packages                                                                                          
Hit http://cn.archive.ubuntu.com precise/restricted i386 Packages                                                                                    
Hit http://cn.archive.ubuntu.com precise/main TranslationIndex                                                                                       
Hit http://cn.archive.ubuntu.com precise/restricted TranslationIndex                                                                                 
Ign http://ppa.launchpad.net precise/main Translation-en_US                                                                                          
Hit http://cn.archive.ubuntu.com precise/main Translation-en                                                                                         
Ign http://extras.ubuntu.com precise/main Translation-en_US                                                                                          
Ign http://extras.ubuntu.com precise/main Translation-en                                                                                             
Hit http://cn.archive.ubuntu.com precise/restricted Translation-en                                                                                   
Ign http://ppa.launchpad.net precise/main Translation-en                                                                                             
Fetched 1,576 B in 10s (147 B/s)                                                                                                                     
W: Failed to fetch file:/var/cache/apt-build/repository/dists/apt-build/main/binary-i386/Packages  File not found
</code></pre>

<p>从网上找到了答案，解决方法就是指定配置文件中的架构：修改<em>/etc/apt/sources.list.d/apt-build.list</em>文件，将其中的</p>

<pre><code>deb file:/var/cache/apt-build/repository apt-build main
</code></pre>

<p>替换为:</p>

<pre><code>deb [arch=amd64] file:/var/cache/apt-build/repository apt-build main
</code></pre>

<p>接下来就是下载源码，再经过漫长的build过程，生成并安装Chromium Web Browser。版本信息如下图:</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2014_chromium_for_linux_37.0.2062.120_info.png" alt="chrome://version" /></p>

<p>下载的源码位于<em>/var/cache/apt-build/build/</em>下：</p>

<p><img src="http://7d9je4.com1.z0.glb.clouddn.com/mogoweb_2014_chromium_ubuntu_source_info.png" alt="" /></p>

<p>从上图中可以看到源码包的大小只有200多M，而我们从chromium开源项目下的源码通常有7、8个G，主要原因是这里下的源码是不带git和svn信息的，是纯粹的源代码。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在本地服务器上建立chromium镜像]]></title>
    <link href="http://mogoweb.net/blog/2014/12/09/mirror-chromium-to-local-server/"/>
    <updated>2014-12-09T21:59:27+08:00</updated>
    <id>http://mogoweb.net/blog/2014/12/09/mirror-chromium-to-local-server</id>
    <content type="html"><![CDATA[<p>Android 5.0发布了好长时间，一直都没有来得及研究。前两周终于将android 5.0源码下载了下来，大致看了一下代码。我所关注的并非Material Design，而是Android 5.0的web引擎。从Android 4.4开始，采用了chromium/blink内核，Android 5.0自然也不例外，只是chromium的版本升级到了37.0.2062.116。想到我的chromium webview项目，仍然采用的是34.0.1847，因此打算也将chromium版本进行一次升级。</p>

<p>因为可恶的GFW，下载代码及其不顺利，虽然有VPN，但是对于几十G的chromium下载量，下载速度太慢，而且git不支持断点续传。在折腾了两三个星期之后，决定在公司的服务器上建立chromium的镜像。不知道从哪个版本开始，gclient开始全面转向git。由于git的天然的分布式特点，这为完全镜像chromium源码库提供了便利。</p>

<p>chromium源码库是由chromium本身加上一堆第三方开源库组成，极其庞大。为此我写了一个脚本，放到了github上，有兴趣的可以访问<a href="https://github.com/mogoweb/chromium_mirror_script">chromium_mirror_script</a>项目，其中chromium_git_list.txt为所有的源码库列表，来自<a href="https://chromium.googlesource.com/">https://chromium.googlesource.com/</a>，随着时间的推移，这个列表也可能发生变化。</p>

<p>有了内部的chromium镜像后，我们可以修改.DEPS.git文件，将其中的git_url值替换为本地git地址，这样通过gclient下载，就是从本地镜像服务器上获取代码了。</p>
]]></content>
  </entry>
  
</feed>
